<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Конструктор тортів | Кремуа</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="icon" href="https://github.com/cakeboxdeveloper/kremua/raw/refs/heads/main/AIcon.ico" type="image/x-icon">

<style>
body { 
  margin: 0;
  font-family: Arial, sans-serif; 
  background: #17212b;
  color: white;
  overflow-x: hidden;
  touch-action: pan-y pinch-zoom;
  -webkit-overflow-scrolling: touch;
}

html {
  overflow-x: hidden;
  width: 100%;
  position: relative;
}

* {
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
}

input, textarea {
  -webkit-user-select: text;
  user-select: text;
}

.app {
  max-width: 390px;
  min-height: 100vh;
  margin: 0 auto;
  padding: 16px;
}

/* ===== ЛОГО ===== */
.header {
  text-align: center;
  margin-top: -40px;
  margin-bottom: -40px;
}

.header video {
  width: 512px;
  max-width: 100%;
  display: block;
  margin: 0 auto;
  mask-image: linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%),
              linear-gradient(to bottom, transparent 0%, black 5%, black 95%, transparent 100%);
  -webkit-mask-image: linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%),
                      linear-gradient(to bottom, transparent 0%, black 5%, black 95%, transparent 100%);
}

/* ===== СЕРВИС ИНФО ===== */
.service-info {
  display: flex;
  flex-direction: column;
  gap: 8px;
  align-items: center;
  margin-top: 12px;
  padding: 0 16px;
}

.service-name {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 22px;
  font-weight: 700;
  color: #6ab2f2;
}

.service-icon {
  width: 19px;
  height: 19px;
  filter: brightness(0) saturate(100%) invert(64%) sepia(66%) saturate(1044%) hue-rotate(178deg) brightness(101%) contrast(93%);
}

.service-users {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
  color: #ffffff;
  opacity: 1;
  margin-bottom: 10px;
}

.users-count {
  font-weight: 700;
  color: #ffffff;
  font-size: 13px;
}

/* ===== FAQ БЛОК ===== */
.faq-block {
  text-align: center;
  margin-bottom: 20px;
}

.faq-content1 {
  background: #1d2b3a;
  border: 1px solid #6ab2f2;
  border-radius: 4px;
  padding: 8px;
  font-size: 15px;
  line-height: 1.4;
  color: #ffffff;
}

/* ===== СЛАЙДЕРЫ ===== */
.slider-section {
  margin-bottom: 16px;
}

.slider-label {
  font-size: 14px;
  font-weight: 600;
  color: #6ab2f2;
  margin-bottom: 8px;
  display: block;
}

.slider-container {
  display: flex;
  gap: 8px;
  overflow-x: auto;
  overflow-y: hidden;
  padding: 4px 0;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
  -ms-overflow-style: none;
}

.slider-container::-webkit-scrollbar {
  display: none;
}

.slider-tag {
  display: inline-block;
  padding: 10px 18px;
  color: #6ab2f2;
  background: #1d2b3a;
  border-radius: 4px;
  font-size: 14px;
  font-weight: 600;
  white-space: nowrap;
  flex-shrink: 0;
  cursor: pointer;
  user-select: none;
  border: 2px solid transparent;
  transition: all 0.2s ease;
}

.slider-tag:hover {
  transform: scale(1.05);
  opacity: 0.85;
}

.slider-tag.selected {
  background: #6ab2f2 !important;
  color: #17212b !important;
  transform: scale(1.08);
}

/* Цвета для разных типов слайдеров */
.type-tag {
  color: #f27db0;
  background: #3a1d2b;
}

.type-tag.selected {
  background: #f27db0 !important;
}

.additive-tag {
  color: #a3f26a;
  background: #1d3a22;
}

.additive-tag.selected {
  background: #a3f26a !important;
  color: #17212b !important;
}

.format-tag {
  color: #f7a632;
  background: #443621;
}

.format-tag.selected {
  background: #f7a632 !important;
  color: #17212b !important;
}

/* ===== ПОЛЕ КОММЕНТАРИЯ ===== */
.comment-section {
  margin-bottom: 16px;
}

.comment-textarea {
  width: 100%;
  min-height: 100px;
  padding: 12px;
  background: #1d2b3a;
  border: 1px solid #6ab2f2;
  border-radius: 4px;
  color: #ffffff;
  font-size: 14px;
  font-family: Arial, sans-serif;
  resize: vertical;
  box-sizing: border-box;
}

.comment-textarea::placeholder {
  color: #6ab2f2;
  opacity: 0.6;
}

/* ===== КНОПКА СОЗДАТЬ ===== */
.create-btn {
  width: 100%;
  padding: 14px 0;
  margin-bottom: 10px;
  text-align: center;
  font-size: 16px;
  font-weight: 700;
  color: #6af27d;
  background: #1d3a22;
  border: 1px solid #6af27d;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.create-btn:hover {
  background: #24502f;
}

.create-btn:active {
  transform: scale(0.96);
}

/* ===== КНОПКА НАЗАД ===== */
.back-btn-full {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  font-weight: 700;
  color: #6ab2f2;
  background: #1d2b3a;
  border: 1px solid #6ab2f2;
  border-radius: 6px;
  padding: 12px;
  cursor: pointer;
  transition: transform 0.15s ease;
  text-decoration: none;
  margin-bottom: 10px;
}

.back-btn-full:active {
  transform: scale(0.96);
}

/* ===== ЛОАДЕР ===== */
.loader {
  position: fixed;
  inset: 0;
  background: #17212b;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.35s ease;
}

.loader.active {
  opacity: 1;
  pointer-events: all;
}

.loader img {
  width: 150px;
  height: 150px;
}

.loader-text {
  margin-top: 16px;
  font-size: 16px;
  color: #6ab2f2;
  font-weight: 600;
}

.loader.blur-mode {
  background: rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
}

/* ===== МОДАЛЬНОЕ ОКНО PDF ===== */
.pdf-modal {
  position: fixed;
  inset: 0;
  background: transparent;
  backdrop-filter: blur(0);
  -webkit-backdrop-filter: blur(0);
  z-index: 9998;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: all 0.4s ease;
}

.pdf-modal.active {
  opacity: 1;
  pointer-events: all;
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  background: rgba(0, 0, 0, 0.5);
}

.pdf-modal-content {
  background: #1d2b3a;
  border: 2px solid #6ab2f2;
  border-radius: 12px;
  padding: 24px;
  max-width: 90%;
  width: 350px;
  text-align: center;
  transform: scale(0.8);
  opacity: 0;
  transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.pdf-modal.active .pdf-modal-content {
  transform: scale(1);
  opacity: 1;
}

.pdf-preview {
  width: 100%;
  max-height: 400px;
  background: white;
  border-radius: 8px;
  margin-bottom: 16px;
  overflow: hidden;
}

.pdf-preview svg {
  width: 100%;
  height: auto;
  display: block;
}

.pdf-hint {
  font-size: 13px;
  color: #6ab2f2;
  margin-bottom: 16px;
  line-height: 1.4;
}

.download-btn {
  width: 100%;
  padding: 14px;
  background: #1d3a22;
  border: 1px solid #6af27d;
  color: #6af27d;
  border-radius: 6px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s ease;
  margin-bottom: 8px;
}

.download-btn:hover {
  background: #24502f;
}

.download-btn:active {
  transform: scale(0.96);
}

.close-modal-btn {
  width: 100%;
  padding: 12px;
  background: transparent;
  border: 1px solid #6ab2f2;
  color: #6ab2f2;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
}

.close-modal-btn:hover {
  background: #22364a;
}

.close-modal-btn:active {
  transform: scale(0.96);
}

/* ===== СОЦСЕТИ ===== */
.bottom-actions {
  display: flex;
  gap: 8px;
  margin-top: 12px;
}

.action-btn {
  flex: 1;
  padding: 14px 0;
  text-align: center;
  font-size: 15px;
  font-weight: 600;
  text-decoration: none;
  color: #fff;
  border-radius: 6px;
  transition: transform 0.15s ease;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}

.action-btn:active {
  transform: scale(0.96);
}

.telegram-btn {
  background: #1d2b3a;
  border: 1px solid #6ab2f2;
  color: #6ab2f2;
}

.telegram-btn:hover {
  background: #22364a;
}

.instagram-btn {
  background: #3a1d2b;
  border: 1px solid #f27db0;
  color: #f27db0;
}

.instagram-btn:hover {
  background: #4a2236;
}
</style>
</head>
<body>

<!-- ЛОАДЕР -->
<div id="loader" class="loader">
  <img src="https://github.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/blob/main/Objects/Hourglass%20Done.webp?raw=true" alt="Загрузка">
  <div class="loader-text">Створюємо креслення...</div>
</div>

<div class="app">
  <!-- HEADER -->
  <div class="header">
    <video autoplay loop muted playsinline>
      <source src="https://cdn.jsdelivr.net/gh/cakeboxdeveloper/kremua@main/ModAvatarModRender.webm" type="video/webm">
    </video>
  </div>

  <!-- СЕРВИС ИНФО -->
  <div class="service-info">
    <div class="service-name">
      <img src="https://raw.githubusercontent.com/CakeBoxDeveloper/kremua/73b661456b59a8bc190ef95c25d08af249023969/5258506.svg" alt="" class="service-icon">
      <span>Кремуа́</span>
    </div>
    <div class="service-users">
      <span class="users-count">1247</span>
      <span>користувачів</span>
    </div>
  </div>

  <!-- ОПИСАНИЕ -->
  <div class="faq-block">
    <div class="faq-content1">
      Створіть власний торт за допомогою конструктора. Оберіть тип, начинку, добавки та формат — ми підготуємо технічне завдання для кондитера.
    </div>
  </div>

  <!-- ТИП ТОРТА -->
  <div class="slider-section">
    <label class="slider-label">Тип торта</label>
    <div class="slider-container" id="typeSlider"></div>
  </div>

  <!-- НАЧИНКИ -->
  <div class="slider-section">
    <label class="slider-label">Начинка</label>
    <div class="slider-container" id="fillingsSlider"></div>
  </div>

  <!-- ДОБАВКИ -->
  <div class="slider-section">
    <label class="slider-label">Добавки</label>
    <div class="slider-container" id="additivesSlider"></div>
  </div>

  <!-- ФОРМАТЫ -->
  <div class="slider-section">
    <label class="slider-label">Формат</label>
    <div class="slider-container" id="formatsSlider"></div>
  </div>

  <!-- КОММЕНТАРИЙ -->
  <div class="comment-section">
    <label class="slider-label">Додатковий коментар</label>
    <textarea 
      id="commentField" 
      class="comment-textarea" 
      placeholder="Впишіть сюди що завгодно: особливі побажання, дизайн, дату виготовлення..."
    ></textarea>
  </div>

  <!-- КНОПКА СОЗДАТЬ -->
  <button class="create-btn" id="createBtn">
    <img src="https://raw.githubusercontent.com/lucide-icons/lucide/main/icons/drafting-compass.svg" style="width: 20px; height: 20px; filter: brightness(0) saturate(100%) invert(78%) sepia(48%) saturate(426%) hue-rotate(72deg) brightness(98%) contrast(93%);">
    Накреслити торт
  </button>

  <!-- КНОПКА НАЗАД -->
  <a href="index.html" class="back-btn-full">
    <img src="https://raw.githubusercontent.com/lucide-icons/lucide/main/icons/arrow-left.svg" style="width: 18px; height: 18px; margin-right: 6px; filter: brightness(0) saturate(100%) invert(64%) sepia(66%) saturate(1044%) hue-rotate(178deg) brightness(101%) contrast(93%);">
    Назад на головну
  </a>

  <!-- СОЦСЕТИ -->
  <div class="bottom-actions">
    <a href="https://t.me/Olga_Dind" class="action-btn telegram-btn">
      <img src="https://raw.githubusercontent.com/lucide-icons/lucide/main/icons/send.svg" style="width: 18px; height: 18px; filter: brightness(0) saturate(100%) invert(64%) sepia(66%) saturate(1044%) hue-rotate(178deg) brightness(101%) contrast(93%);">
      Telegram
    </a>
    <a href="https://www.instagram.com/kremua_studio" class="action-btn instagram-btn">
      <img src="https://raw.githubusercontent.com/lucide-icons/lucide/main/icons/instagram.svg" style="width: 18px; height: 18px; filter: brightness(0) saturate(100%) invert(70%) sepia(58%) saturate(1313%) hue-rotate(298deg) brightness(102%) contrast(90%);">
      Instagram
    </a>
  </div>
</div>

<!-- МОДАЛЬНОЕ ОКНО PDF -->
<div id="pdfModal" class="pdf-modal">
  <div class="pdf-modal-content">
    <div class="pdf-preview" id="pdfPreview"></div>
    <p class="pdf-hint">
      Це технічне завдання потрібно відправити кондитеру у першому повідомленні разом із фото бажаного дизайну торта
    </p>
    <button class="download-btn" id="downloadBtn">
      Завантажити PDF
    </button>
    <button class="close-modal-btn" id="closeModalBtn">
      Закрити
    </button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/svg2pdf.js/2.2.1/svg2pdf.min.js"></script>

<script>
// ===== ДАННЫЕ =====
const cakeTypes = [
  "#безе", "#бісквіт", "#слоєне тісто", 
  "#горіховий", "#шоколадний", "#сирний"
];

const allFillings = [
  "#фісташка", "#брауні", "#карамель", "#латте", 
  "#пломбір", "#ром", "#пінаколада", "#сінабон",
  "#мускат", "#ірландський віскі", "#мультифрукт",
  "#лісові ягоди", "#банан", "#мохіто", "#матча",
  "#баблгам", "#снікерс", "#орео", "#тірамісу",
  "#ваніль", "#глінтвейн", "#мед", "#цитрус",
  "#тропік", "#абрикос", "#вишня", "#праліне"
];

const additives = [
  "#волоські горіхи", "#мигдаль", "#фундук",
  "#желе", "#рисові кульки", "#маршмелоу",
  "#шоколадні чіпси", "#кокосова стружка",
  "#сухофрукти", "#карамельний попкорн"
];

const formats = [
  "#спліт", "#бенто", "#максі", "#XXL"
];

// ===== СОЗДАНИЕ СЛАЙДЕРОВ =====
function createSlider(containerId, items, className) {
  const container = document.getElementById(containerId);
  items.forEach(item => {
    const tag = document.createElement('span');
    tag.className = `slider-tag ${className}`;
    tag.textContent = item;
    tag.onclick = function() {
      // Снять выделение с других
      container.querySelectorAll('.slider-tag').forEach(t => t.classList.remove('selected'));
      // Выделить текущий
      this.classList.add('selected');
    };
    container.appendChild(tag);
  });
}

createSlider('typeSlider', cakeTypes, 'type-tag');
createSlider('fillingsSlider', allFillings, 'slider-tag');
createSlider('additivesSlider', additives, 'additive-tag');
createSlider('formatsSlider', formats, 'format-tag');

// ===== СБОР ДАННЫХ =====
function getSelectedData() {
  const type = document.querySelector('#typeSlider .slider-tag.selected')?.textContent || 'не обрано';
  const filling = document.querySelector('#fillingsSlider .slider-tag.selected')?.textContent || 'не обрано';
  const additive = document.querySelector('#additivesSlider .slider-tag.selected')?.textContent || 'не обрано';
  const format = document.querySelector('#formatsSlider .slider-tag.selected')?.textContent || 'не обрано';
  const comment = document.getElementById('commentField').value || 'немає';
  
  return { type, filling, additive, format, comment };
}

// ===== SVG ЧЕРТЁЖ =====
function generateBlueprintSVG(data) {
  return `
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 800" style="background: #0a1628;">
  <!-- Заголовок -->
  <text x="300" y="40" font-family="Arial" font-size="24" font-weight="bold" fill="#6ab2f2" text-anchor="middle">
    ТЕХНІЧНЕ ЗАВДАННЯ
  </text>
  <text x="300" y="65" font-family="Arial" font-size="14" fill="#6ab2f2" text-anchor="middle" opacity="0.7">
    Кремуа | Конструктор тортів
  </text>
  
  <!-- Рамка -->
  <rect x="40" y="90" width="520" height="650" fill="none" stroke="#6ab2f2" stroke-width="2" stroke-dasharray="10,5"/>
  
  <!-- Сетка фона -->
  <defs>
    <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
      <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#6ab2f2" stroke-width="0.5" opacity="0.1"/>
    </pattern>
  </defs>
  <rect x="40" y="90" width="520" height="650" fill="url(#grid)"/>
  
  <!-- Данные -->
  <text x="70" y="140" font-family="Arial" font-size="16" font-weight="bold" fill="#f27db0">
    Тип торта:
  </text>
  <text id="blueprint-cake-type" x="200" y="140" font-family="Arial" font-size="16" fill="#ffffff">
    ${data.type}
  </text>
  
  <text x="70" y="190" font-family="Arial" font-size="16" font-weight="bold" fill="#6ab2f2">
    Начинка:
  </text>
  <text id="blueprint-filling" x="200" y="190" font-family="Arial" font-size="16" fill="#ffffff">
    ${data.filling}
  </text>
  
  <text x="70" y="240" font-family="Arial" font-size="16" font-weight="bold" fill="#a3f26a">
    Добавки:
  </text>
  <text id="blueprint-additives" x="200" y="240" font-family="Arial" font-size="16" fill="#ffffff">
    ${data.additive}
  </text>
  
  <text x="70" y="290" font-family="Arial" font-size="16" font-weight="bold" fill="#f7a632">
    Формат:
  </text>
  <text id="blueprint-format" x="200" y="290" font-family="Arial" font-size="16" fill="#ffffff">
    ${data.format}
  </text>
  
  <!-- Комментарий -->
  <text x="70" y="350" font-family="Arial" font-size="16" font-weight="bold" fill="#6ab2f2">
    Коментар:
  </text>
  <foreignObject x="70" y="365" width="460" height="350">
    <div xmlns="http://www.w3.org/1999/xhtml" style="font-family: Arial; font-size: 14px; color: #ffffff; line-height: 1.6; word-wrap: break-word;">
      ${data.comment}
    </div>
  </foreignObject>
  
  <!-- Футер -->
  <text x="300" y="760" font-family="Arial" font-size="12" fill="#6ab2f2" text-anchor="middle" opacity="0.6">
    Відправте це ТЗ кондитеру разом із фото бажаного дизайну
  </text>
</svg>
  `;
}

// ===== СОЗДАНИЕ PDF =====
async function generatePDF(svgString) {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF('p', 'mm', 'a4');
  
  const svgElement = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
  svgElement.innerHTML = svgString;
  svgElement.setAttribute('width', '600');
  svgElement.setAttribute('height', '800');
  
  try {
    await pdf.svg(svgElement, {
      x: 5,
      y: 5,
      width: 200,
      height: 267
    });
    
    return pdf;
  } catch (error) {
    console.error('Ошибка создания PDF:', error);
    return null;
  }
}

// ===== ПОКАЗ МОДАЛКИ =====
function showPDFModal(svgString, pdfDoc) {
  const modal = document.getElementById('pdfModal');
  const preview = document.getElementById('pdfPreview');
  
  preview.innerHTML = svgString;
  modal.classList.add('active');
  
  // Кнопка скачивания
  document.getElementById('downloadBtn').onclick = function() {
    if (pdfDoc) {
      pdfDoc.save('kremua-cake-blueprint.pdf');
    }
  };
  
  // Закрытие
  document.getElementById('closeModalBtn').onclick = function() {
    modal.classList.remove('active');
  };
  
  modal.onclick = function(e) {
    if (e.target === modal) {
      modal.classList.remove('active');
    }
  };
}

// ===== ОСНОВНАЯ ЛОГИКА =====
document.getElementById('createBtn').onclick = async function() {
  const data = getSelectedData();
  
  // Показываем лоадер
  const loader = document.getElementById('loader');
  loader.classList.add('active');
  
  // Генерируем SVG
  const svgString = generateBlueprintSVG(data);
  
  // Создаём PDF
  const pdfDoc = await generatePDF(svgString);
  
  // Через 2 секунды показываем модалку
  setTimeout(() => {
    loader.classList.remove('active');
    showPDFModal(svgString, pdfDoc);
  }, 2000);
};

// ===== СКРЫТИЕ ЛОАДЕРА ПРИ ЗАГРУЗКЕ =====
window.addEventListener('load', () => {
  document.getElementById('loader').classList.remove('active');
});
</script>

</body>
</html>
