<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Конструктор тортів | Кремуа</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="icon" href="https://github.com/cakeboxdeveloper/kremua/raw/refs/heads/main/AIcon.ico" type="image/x-icon">

<style>
body { 
  margin: 0;
  font-family: Arial, sans-serif; 
  background: #17212b;
  color: white;
  overflow-x: hidden;
  touch-action: pan-y pinch-zoom;
  -webkit-overflow-scrolling: touch;
}

#formatsSlider {
  display: flex;
  justify-content: space-between;
  overflow: hidden;
  gap: 4px;
}

#formatsSlider .format-tag {
  flex: 1;
  text-align: center;
  padding: 10px 4px;
  font-size: 13px;
  min-width: 0;
}
  
html {
  overflow-x: hidden;
  width: 100%;
  position: relative;
}

* {
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
}

input, textarea {
  -webkit-user-select: text;
  user-select: text;
}

.app {
  max-width: 390px;
  min-height: 100vh;
  margin: 0 auto;
  padding: 16px;
}

.header {
  text-align: center;
  margin-top: -40px;
  margin-bottom: -40px;
}

.header video {
  width: 512px;
  max-width: 100%;
  display: block;
  margin: 0 auto;
  mask-image: linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%),
              linear-gradient(to bottom, transparent 0%, black 5%, black 95%, transparent 100%);
  -webkit-mask-image: linear-gradient(to right, transparent 0%, black 5%, black 95%, transparent 100%),
                      linear-gradient(to bottom, transparent 0%, black 5%, black 95%, transparent 100%);
}

.service-info {
  display: flex;
  flex-direction: column;
  gap: 8px;
  align-items: center;
  margin-top: 12px;
  padding: 0 16px;
}

.service-name {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 22px;
  font-weight: 700;
  color: #6ab2f2;
  z-index: 1000;
  position: relative;
}

.service-icon {
  width: 19px;
  height: 19px;
  filter: brightness(0) saturate(100%) invert(64%) sepia(66%) saturate(1044%) hue-rotate(178deg) brightness(101%) contrast(93%);
}

.service-users {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
  color: #ffffff;
  margin-bottom: 10px;
}

.users-count {
  font-weight: 700;
}

.faq-block {
  text-align: center;
  margin-bottom: 20px;
}

.faq-content1 {
  background: #1d2b3a;
  border: 1px solid #6ab2f2;
  border-radius: 4px;
  padding: 8px;
  font-size: 15px;
  line-height: 1.4;
}

.slider-section {
  margin-bottom: 16px;
}

.slider-label {
  font-size: 15px;
  color: #6ab2f2;
  margin-bottom: 8px;
  display: block;
  text-align: center;
  background: #1d2b3a;
  border: 1px solid #6ab2f2;
  border-radius: 4px;
  padding: 8px;
}

.slider-container {
  display: flex;
  gap: 8px;
  overflow-x: auto;
  padding: 4px 0;
  scrollbar-width: none;
  -ms-overflow-style: none;
}

.slider-container::-webkit-scrollbar { display: none; }

.slider-tag {
  display: inline-block;
  padding: 10px 18px;
  color: #6ab2f2;
  background: #1d2b3a;
  border-radius: 4px;
  font-size: 14px;
  font-weight: 600;
  white-space: nowrap;
  flex-shrink: 0;
  cursor: pointer;
  border: 2px solid transparent;
  transition: opacity 0.2s ease, background 0.2s ease;
}

/* УБРАЛИ TRANSFORM SCALE */
.slider-tag:hover {
  opacity: 0.85;
}

.slider-tag.selected {
  background: #6ab2f2 !important;
  color: #17212b !important;
}

.type-tag { color: #f27db0; background: #3a1d2b; }
.type-tag.selected { background: #f27db0 !important; }

.additive-tag { color: #a3f26a; background: #1d3a22; }
.additive-tag.selected { background: #a3f26a !important; color: #17212b !important; }

.format-tag { color: #f7a632; background: #443621; }
.format-tag.selected { background: #f7a632 !important; color: #17212b !important; }

.comment-textarea {
  width: 100%;
  min-height: 100px;
  padding: 12px;
  background: #1d2b3a;
  border: 1px solid #6ab2f2;
  border-radius: 4px;
  color: #ffffff;
  box-sizing: border-box;
}

.create-btn {
  width: 100%;
  padding: 14px 0;
  margin-bottom: 10px;
  font-weight: 700;
  color: #6af27d;
  background: #1d3a22;
  border: 1px solid #6af27d;
  border-radius: 6px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.create-btn:active { transform: scale(0.96); }

/* ЛОАДЕР И МОДАЛКА */
.loader {
  position: fixed;
  inset: 0;
  background: #17212b;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.35s ease;
}
.loader.active { opacity: 1; pointer-events: all; }

.pdf-modal {
  position: fixed;
  inset: 0;
  z-index: 9998;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: all 0.4s ease;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(20px);
}
.pdf-modal.active { opacity: 1; pointer-events: all; }

.pdf-modal-content {
  background: #1d2b3a;
  border: 2px solid #6ab2f2;
  border-radius: 12px;
  padding: 24px;
  width: 90%;
  max-width: 350px;
  text-align: center;
}

.pdf-preview {
  width: 100%;
  background: white;
  border-radius: 8px;
  margin-bottom: 16px;
  overflow: hidden;
}

.download-btn {
  width: 100%;
  padding: 14px;
  background: #1d3a22;
  border: 1px solid #6af27d;
  color: #6af27d;
  border-radius: 6px;
  font-weight: 700;
  cursor: pointer;
  margin-bottom: 8px;
}

.close-modal-btn {
  width: 100%;
  padding: 12px;
  background: transparent;
  border: 1px solid #6ab2f2;
  color: #6ab2f2;
  border-radius: 6px;
  cursor: pointer;
}

.bottom-actions { display: flex; gap: 8px; margin-top: 12px; }
.action-btn {
  flex: 1; padding: 14px 0; text-align: center; font-weight: 600;
  text-decoration: none; border-radius: 6px; display: flex; align-items: center; justify-content: center; gap: 6px;
}
.telegram-btn { background: #1d2b3a; border: 1px solid #6ab2f2; color: #6ab2f2; }
.instagram-btn { background: #3a1d2b; border: 1px solid #f27db0; color: #f27db0; }
</style>
</head>
<body>

<div id="loader" class="loader">
  <img src="https://github.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/blob/main/Objects/Hourglass%20Done.webp?raw=true" width="150">
  <div class="loader-text" style="color:#6ab2f2; margin-top:10px;">Створюємо креслення...</div>
</div>

<div class="app">
  <div class="header">
    <video autoplay loop muted playsinline>
      <source src="https://cdn.jsdelivr.net/gh/cakeboxdeveloper/kremua@main/ModAvatarModRender.webm" type="video/webm">
    </video>
  </div>

  <div class="service-info">
    <div class="service-name">
      <img src="https://raw.githubusercontent.com/CakeBoxDeveloper/kremua/73b661456b59a8bc190ef95c25d08af249023969/5258506.svg" class="service-icon">
      <span>Кремуа́</span>
    </div>
    <div class="service-users">
      <span class="users-count">1247</span> користувачів
    </div>
  </div>

  <div class="faq-block">
    <div class="faq-content1">Створіть власний торт. Оберіть параметри, а ми підготуємо ТЗ для кондитера.</div>
  </div>

  <div class="slider-section">
    <div class="slider-label">Тип торта</div>
    <div class="slider-container" id="typeSlider"></div>
  </div>

  <div class="slider-section">
    <div class="slider-label">Начинка</div>
    <div class="slider-container" id="fillingsSlider"></div>
  </div>

  <div class="slider-section">
    <div class="slider-label">Добавки (можна декілька)</div>
    <div class="slider-container" id="additivesSlider"></div>
  </div>

  <div class="slider-section">
    <div class="slider-label">Формат</div>
    <div class="slider-container" id="formatsSlider"></div>
  </div>

  <div class="comment-section">
    <div class="slider-label">Додатковий коментар</div>
    <textarea id="commentField" class="comment-textarea" placeholder="Ваші побажання..."></textarea>
  </div>

  <button class="create-btn" id="createBtn">Накреслити торт</button>

  <div class="bottom-actions">
    <a href="https://t.me/Olga_Dind" class="action-btn telegram-btn">Telegram</a>
    <a href="https://www.instagram.com/kremua_studio" class="action-btn instagram-btn">Instagram</a>
  </div>
</div>

<div id="pdfModal" class="pdf-modal">
  <div class="pdf-modal-content">
    <div class="pdf-preview" id="pdfPreview"></div>
    <button class="download-btn" id="downloadBtn">Завантажити PDF</button>
    <button class="close-modal-btn" id="closeModalBtn">Закрити</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
const cakeTypes = ["#безе", "#бісквіт", "#слоєне тісто", "#горіховий", "#шоколадний", "#сирний"];
const allFillings = ["#фісташка", "#брауні", "#карамель", "#латте", "#пломбір", "#ваніль", "#вишня"];
const additivesList = ["#горіхи", "#мигдаль", "#фундук", "#желе", "#маршмелоу", "#кокос"];
const formats = ["#спліт", "#бенто", "#максі", "#XXL"];

// УНИВЕРСАЛЬНАЯ ФУНКЦИЯ СОЗДАНИЯ СЛАЙДЕРОВ
function createSlider(containerId, items, className) {
  const container = document.getElementById(containerId);
  const isMulti = containerId === 'additivesSlider';

  items.forEach(item => {
    const tag = document.createElement('span');
    tag.className = `slider-tag ${className}`;
    tag.textContent = item;
    
    tag.onclick = function() {
      if (isMulti) {
        this.classList.toggle('selected'); // Мульти-выбор
      } else {
        // Одиночный выбор с возможностью отмены (Deselect)
        if (this.classList.contains('selected')) {
          this.classList.remove('selected');
        } else {
          container.querySelectorAll('.slider-tag').forEach(t => t.classList.remove('selected'));
          this.classList.add('selected');
        }
      }
    };
    container.appendChild(tag);
  });
}

createSlider('typeSlider', cakeTypes, 'type-tag');
createSlider('fillingsSlider', allFillings, 'slider-tag');
createSlider('additivesSlider', additivesList, 'additive-tag');
createSlider('formatsSlider', formats, 'format-tag');

function getSelectedData() {
  const type = document.querySelector('#typeSlider .slider-tag.selected')?.textContent || 'не обрано';
  const filling = document.querySelector('#fillingsSlider .slider-tag.selected')?.textContent || 'не обрано';
  const format = document.querySelector('#formatsSlider .slider-tag.selected')?.textContent || 'не обрано';
  
  const additiveEls = document.querySelectorAll('#additivesSlider .slider-tag.selected');
  const additive = additiveEls.length > 0 
    ? Array.from(additiveEls).map(el => el.textContent).join(', ') 
    : 'без добавок';

  const userComment = document.getElementById('commentField').value.trim();
  const comment = userComment !== "" 
    ? userComment 
    : "Бачу, що ви нічого не написали, отже довіряєте нам. Круто, ми вас не підведемо!";

  const orderNumber = Math.floor(10000 + Math.random() * 90000);
  const infoText = `Зробіть ${type} торт з ${filling} начинкою. Додайте в нього ${additive}. Формат: ${format}.`;

  return { orderNumber, infoText, comment };
}

// ГЕНЕРАЦИЯ SVG (ЗАМЕНИТЕ НА ВАШ ШАБЛОН)
function generateBlueprintSVG(data) {
  return `
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 500" style="background:#0a1628;">
  <g id="All">
    <rect id="background" width="400" height="500" fill="#0a1628"/>
    <text id="order" x="20" y="40" font-family="Arial" font-size="18" fill="#6ab2f2">Замовлення: #${data.orderNumber}</text>
    
    <text x="20" y="80" font-family="Arial" font-size="14" font-weight="bold" fill="#6ab2f2">Деталі:</text>
    <foreignObject id="info" x="20" y="90" width="360" height="100">
      <div xmlns="http://www.w3.org/1999/xhtml" style="color:white; font-family:Arial; font-size:13px; line-height:1.4;">
        ${data.infoText}
      </div>
    </foreignObject>

    <text x="20" y="220" font-family="Arial" font-size="14" font-weight="bold" fill="#6ab2f2">Коментар:</text>
    <foreignObject id="comment" x="20" y="230" width="360" height="200">
      <div xmlns="http://www.w3.org/1999/xhtml" style="color:white; font-family:Arial; font-size:13px; line-height:1.4; font-style:italic;">
        ${data.comment}
      </div>
    </foreignObject>
  </g>
</svg>`;
}

document.getElementById('createBtn').onclick = async function() {
  const data = getSelectedData();
  const loader = document.getElementById('loader');
  loader.classList.add('active');

  const svgString = generateBlueprintSVG(data);
  
  // Создание PDF через jsPDF
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  
  // Простая текстовая сборка для PDF (т.к. SVG с кириллицей в PDF требует шрифтов)
  doc.setFontSize(20);
  doc.text(`ЗАМОВЛЕННЯ #${data.orderNumber}`, 20, 20);
  doc.setFontSize(12);
  const infoLines = doc.splitTextToSize(data.infoText, 170);
  doc.text(infoLines, 20, 40);
  doc.text("Коментар:", 20, 80);
  const commentLines = doc.splitTextToSize(data.comment, 170);
  doc.text(commentLines, 20, 90);

  setTimeout(() => {
    loader.classList.remove('active');
    const modal = document.getElementById('pdfModal');
    document.getElementById('pdfPreview').innerHTML = svgString;
    modal.classList.add('active');
    
    document.getElementById('downloadBtn').onclick = () => doc.save(`order-${data.orderNumber}.pdf`);
  }, 1500);
};

document.getElementById('closeModalBtn').onclick = () => document.getElementById('pdfModal').classList.remove('active');
</script>
</body>
</html>
