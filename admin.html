<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –±–∏–ª–µ—Ç–æ–≤</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #17212b;
      color: white;
      padding: 20px;
      min-height: 100vh;
    }
    .admin-container {
      max-width: 900px;
      margin: 0 auto;
    }
    .icon {
      width: 20px;
      height: 20px;
      vertical-align: middle;
      display: inline-block;
    }
    .icon-lg {
      width: 32px;
      height: 32px;
      vertical-align: middle;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }
    .stat-card {
      background: #1d2b3a;
      border: none;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
    }
    .stat-number {
      font-size: 36px;
      font-weight: 700;
      color: #6ab2f2;
      margin: 10px 0;
    }
    .stat-label {
      font-size: 14px;
      opacity: 0.85;
    }
    .control-panel {
      background: #1d2b3a;
      border: 1px solid #6ab2f2;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .button-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 15px;
    }
    .btn {
      padding: 14px 24px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.15s ease;
      font-size: 15px;
      border: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
    }
    .btn:active {
      transform: scale(0.96);
    }
    .btn-primary {
      background: #1d3a22;
      border: 1px solid #6af27d;
      color: #6af27d;
    }
    .btn-danger {
      background: #3a1d2b;
      border: 1px solid #f27db0;
      color: #f27db0;
    }
    .btn-secondary {
      background: #1d2b3a;
      border: 1px solid #6ab2f2;
      color: #6ab2f2;
    }
    .ticket-output {
      background: transparent;
      border: none;
      border-radius: 4px;
      padding: 15px;
      margin: 15px 0;
      word-wrap: break-word;
      font-family: monospace;
      font-size: 14px;
      line-height: 1.6;
    }
    .ticket-link {
      color: #6ab2f2;
      text-decoration: none;
      display: block;
      margin: 5px 0;
      word-break: break-all;
    }
    .dashboard {
      background: transparent;
      border: none;
      border-radius: 8px;
      padding: 0;
    }
    .tickets-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0;
      border: 1px solid #6ab2f2;
      border-radius: 8px;
      overflow: hidden;
    }
    .tickets-table th {
      background: #6ab2f2;
      color: #17212b;
      padding: 12px;
      text-align: left;
      font-size: 14px;
      font-weight: 700;
    }
    .tickets-table th:first-child {
      border-top-left-radius: 8px;
    }
    .tickets-table th:last-child {
      border-top-right-radius: 8px;
    }
    .tickets-table td {
      padding: 12px;
      border-bottom: 1px solid rgba(106, 178, 242, 0.2);
      font-size: 14px;
    }
    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
    }
    .status-active {
      background: #1d3a22;
      color: #6af27d;
      border: 1px solid #6af27d;
    }
    .status-used {
      background: #3a1d2b;
      color: #f27db0;
      border: 1px solid #f27db0;
    }
    .ticket-code {
      font-family: monospace;
      font-weight: 600;
      color: #6ab2f2;
    }
    .empty-state {
      text-align: center;
      padding: 40px;
      opacity: 0.5;
    }
    .copy-icon {
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.2s;
      margin: 0 8px;
      width: 20px;
      height: 20px;
      display: inline-block;
      vertical-align: middle;
    }
    .copy-icon:hover {
      opacity: 1;
    }
    .action-icons {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .btn-full {
      width: 100%;
      margin-top: 10px;
    }
    .btn-color {
  padding: 12px;
  font-size: 14px;
  font-weight: 600;
  transition: all 0.2s ease;
  opacity: 0.6;
}
.btn-color.selected {
  opacity: 1;
  transform: scale(1.05);
  box-shadow: 0 0 15px currentColor;
}
  </style>
</head>
<body>
  <div class="admin-container">
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">–í—Å–µ–≥–æ –±–∏–ª–µ—Ç–æ–≤</div>
        <div class="stat-number" id="totalTickets">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label"><img src="https://github.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/blob/main/Symbols/Check%20Mark%20Button.webp?raw=true" class="icon"> –ê–∫—Ç–∏–≤–Ω—ã–µ</div>
        <div class="stat-number" style="color: #6af27d;" id="activeTickets">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label"><img src="https://github.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/blob/main/Symbols/Cross%20Mark.webp?raw=true" class="icon"> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ</div>
        <div class="stat-number" style="color: #8b0000;" id="usedTicketsCount">0</div>
      </div>
    </div>
    
    <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
   <div class="control-panel">
  <div style="margin-bottom: 15px;">
    <label style="display: block; margin-bottom: 8px; font-weight: 600;">–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç –±–∏–ª–µ—Ç–∞:</label>
    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
      <button class="btn btn-color" onclick="selectColor('red')" id="color-red" style="background: #3a1d1d; border: 2px solid #f25c5c; color: #f25c5c;">
        üî¥ –ö—Ä–∞—Å–Ω—ã–π
      </button>
      <button class="btn btn-color" onclick="selectColor('blue')" id="color-blue" style="background: #1d2b3a; border: 2px solid #6ab2f2; color: #6ab2f2;">
        üîµ –°–∏–Ω–∏–π
      </button>
      <button class="btn btn-color" onclick="selectColor('green')" id="color-green" style="background: #1d3a22; border: 2px solid #6af27d; color: #6af27d;">
        üü¢ –ó–µ–ª—ë–Ω—ã–π
      </button>
      <button class="btn btn-color" onclick="selectColor('yellow')" id="color-yellow" style="background: #3a351d; border: 2px solid #f2d16a; color: #f2d16a;">
        üü° –ñ—ë–ª—Ç—ã–π
      </button>
    </div>
  </div>
  
  <div class="button-row">
    <button class="btn btn-primary" onclick="generateTicket()">
      <img src="https://github.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/blob/main/Symbols/New%20Button.webp?raw=true" class="icon"> –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –±–∏–ª–µ—Ç
    </button>
    <button class="btn btn-danger" onclick="clearAll()">
      <img src="https://github.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/blob/main/Food%20and%20Drink/Cup%20With%20Straw.webp?raw=true" class="icon"> –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –±–∏–ª–µ—Ç—ã
    </button>
  </div>
  
  <div id="output"></div>
</div>
    
    
    <!-- –î–∞—à–±–æ—Ä–¥ –±–∏–ª–µ—Ç–æ–≤ -->
    <div class="dashboard">
      <div id="ticketsDashboard">
        <div class="empty-state">
          –ù–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤
        </div>
      </div>
    </div>
  </div>

 <script>
// ‚ö†Ô∏è –°–ï–ö–†–ï–¢–ù–´–ô –ö–õ–Æ–ß - –•–†–ê–ù–ò –í –°–ï–ö–†–ï–¢–ï! –°–ú–ï–ù–ò –ù–ê –°–í–û–ô!
const SECRET_KEY = "your-super-secret-key-change-this-12345";

let lastTicket = '';
let selectedColor = 'red'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫—Ä–∞—Å–Ω—ã–π

// –§—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ —Ü–≤–µ—Ç–∞
function selectColor(color) {
  selectedColor = color;
  
  // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
  document.querySelectorAll('.btn-color').forEach(btn => {
    btn.classList.remove('selected');
  });
  
  // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É
  document.getElementById('color-' + color).classList.add('selected');
}

// –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ HMAC-SHA256
async function generateHMAC(secret, message) {
  const encoder = new TextEncoder();
  const keyData = encoder.encode(secret);
  const messageData = encoder.encode(message);
  
  const cryptoKey = await crypto.subtle.importKey(
    'raw',
    keyData,
    { name: 'HMAC', hash: 'SHA-256' },
    false,
    ['sign']
  );
  
  const signature = await crypto.subtle.sign('HMAC', cryptoKey, messageData);
  
  return Array.from(new Uint8Array(signature))
    .map(b => b.toString(16).padStart(2, '0'))
    .join('')
    .substring(0, 16);
}

function generateTicketCode() {
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  let code = '';
  for (let i = 0; i < 8; i++) {
    code += chars[Math.floor(Math.random() * chars.length)];
  }
  return code;
}

async function generateTicket() {
  const timestamp = Date.now();
  const randomData = generateTicketCode();
  const ticketData = `${timestamp}-${randomData}`;
  
  const signature = await generateHMAC(SECRET_KEY, ticketData);
  const ticketCode = `${ticketData}-${signature}`;
  const created = new Date().toISOString();
  
  const generatedTickets = JSON.parse(localStorage.getItem('generated_tickets') || '[]');
  generatedTickets.push({
    code: ticketCode,
    created: created,
    shortCode: randomData,
    color: selectedColor // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ü–≤–µ—Ç
  });
  localStorage.setItem('generated_tickets', JSON.stringify(generatedTickets));
  
  const currentUrl = window.location.href;
  const baseUrl = currentUrl.substring(0, currentUrl.lastIndexOf('/') + 1);
  // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä color –≤ URL
  const ticketUrl = `${baseUrl}roll.html?ticket=${encodeURIComponent(ticketCode)}&color=${selectedColor}`;
  
  lastTicket = ticketUrl;
  
  const colorEmoji = {
    'red': 'üî¥',
    'blue': 'üîµ',
    'green': 'üü¢',
    'yellow': 'üü°'
  };
  
  const colorName = {
    'red': '–ö—Ä–∞—Å–Ω—ã–π',
    'blue': '–°–∏–Ω–∏–π',
    'green': '–ó–µ–ª—ë–Ω—ã–π',
    'yellow': '–ñ—ë–ª—Ç—ã–π'
  };
  
  const output = document.getElementById('output');
  output.innerHTML = `
    <div class="ticket-output">
      <strong><img src="https://github.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/blob/main/Symbols/Check%20Mark%20Button.webp?raw=true" class="icon"> –ù–æ–≤—ã–π –±–∏–ª–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!</strong><br><br>
      <strong>–ö–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥:</strong> ${randomData}<br>
      <strong>–¶–≤–µ—Ç:</strong> ${colorEmoji[selectedColor]} ${colorName[selectedColor]}<br><br>
      <a href="${ticketUrl}" target="_blank" class="ticket-link">${ticketUrl}</a><br>
      <button class="btn btn-secondary btn-full" onclick="copyToClipboard('${ticketUrl}')">
        <img src="https://github.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/blob/main/Objects/Memo.webp?raw=true" class="icon"> –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
      </button>
    </div>
  `;
  
  refreshDashboard();
}

function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(() => {
    alert('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
  });
}

function deleteTicket(ticketCode) {
  if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –±–∏–ª–µ—Ç?')) {
    const generatedTickets = JSON.parse(localStorage.getItem('generated_tickets') || '[]');
    const filtered = generatedTickets.filter(t => t.code !== ticketCode);
    localStorage.setItem('generated_tickets', JSON.stringify(filtered));
    
    const usedTickets = JSON.parse(localStorage.getItem('used_tickets') || '[]');
    const filteredUsed = usedTickets.filter(code => code !== ticketCode);
    localStorage.setItem('used_tickets', JSON.stringify(filteredUsed));
    
    refreshDashboard();
    alert('‚úÖ –ë–∏–ª–µ—Ç —É–¥–∞–ª–µ–Ω!');
  }
}

function refreshDashboard() {
  const generatedTickets = JSON.parse(localStorage.getItem('generated_tickets') || '[]');
  const usedTickets = JSON.parse(localStorage.getItem('used_tickets') || '[]');
  
  const activeCount = generatedTickets.filter(t => !usedTickets.includes(t.code)).length;
  document.getElementById('totalTickets').textContent = generatedTickets.length;
  document.getElementById('activeTickets').textContent = activeCount;
  document.getElementById('usedTicketsCount').textContent = usedTickets.length;
  
  const dashboard = document.getElementById('ticketsDashboard');
  
  if (generatedTickets.length === 0) {
    dashboard.innerHTML = '<div class="empty-state">–ù–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤</div>';
    return;
  }
  
  const currentUrl = window.location.href;
  const baseUrl = currentUrl.substring(0, currentUrl.lastIndexOf('/') + 1);
  
  const colorEmoji = {
    'red': 'üî¥',
    'blue': 'üîµ',
    'green': 'üü¢',
    'yellow': 'üü°'
  };
  
  let tableHTML = `
    <table class="tickets-table">
      <thead>
        <tr>
          <th>–ö–æ–¥</th>
          <th>–¶–≤–µ—Ç</th>
          <th>–°—Ç–∞—Ç—É—Å</th>
          <th>–°–æ–∑–¥–∞–Ω–æ</th>
          <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody>
  `;
  
  const sortedTickets = [...generatedTickets].sort((a, b) => {
    const aUsed = usedTickets.includes(a.code);
    const bUsed = usedTickets.includes(b.code);
    if (aUsed === bUsed) return new Date(b.created) - new Date(a.created);
    return aUsed ? 1 : -1;
  });
  
  sortedTickets.forEach(ticket => {
    const isUsed = usedTickets.includes(ticket.code);
    const ticketColor = ticket.color || 'red';
    const ticketUrl = `${baseUrl}roll.html?ticket=${encodeURIComponent(ticket.code)}&color=${ticketColor}`;
    const date = new Date(ticket.created).toLocaleString('ru-RU', {
      day: '2-digit',
      month: '2-digit',
      year: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
    
    tableHTML += `
      <tr>
        <td><span class="ticket-code">${ticket.shortCode || ticket.code.substring(0, 8)}</span></td>
        <td>${colorEmoji[ticketColor]}</td>
        <td>
          <span class="status-badge ${isUsed ? 'status-used' : 'status-active'}">
            ${isUsed ? '<img src="https://github.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/blob/main/Symbols/Cross%20Mark.webp?raw=true" class="icon"> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω' : '<img src="https://github.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/blob/main/Symbols/Check%20Mark%20Button.webp?raw=true" class="icon"> –ê–∫—Ç–∏–≤–Ω—ã–π'}
          </span>
        </td>
        <td>${date}</td>
        <td>
          <div class="action-icons">
            ${!isUsed ? `
              <img src="https://github.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/blob/main/Objects/Memo.webp?raw=true" 
                   class="copy-icon" 
                   onclick="copyToClipboard('${ticketUrl}')" 
                   title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É">
              <a href="${ticketUrl}" target="_blank" title="–û—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É">
                <img src="https://github.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/blob/main/Travel%20and%20Places/Airplane.webp?raw=true" class="copy-icon">
              </a>
            ` : ''}
            <img src="https://github.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/blob/main/Objects/Bomb.webp?raw=true" 
                 class="copy-icon" 
                 onclick="deleteTicket('${ticket.code}')" 
                 title="–£–¥–∞–ª–∏—Ç—å –±–∏–ª–µ—Ç"
                 style="opacity: 0.5;">
          </div>
        </td>
      </tr>
    `;
  });
  
  tableHTML += '</tbody></table>';
  dashboard.innerHTML = tableHTML;
}

function clearAll() {
  if (confirm('‚ö†Ô∏è –£–¥–∞–ª–∏—Ç—å –í–°–ï –±–∏–ª–µ—Ç—ã –∏ –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ!')) {
    localStorage.removeItem('generated_tickets');
    localStorage.removeItem('used_tickets');
    localStorage.removeItem('lottery_last_spin');
    document.getElementById('output').innerHTML = '';
    refreshDashboard();
    alert('‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã!');
  }
}

// –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞—à–±–æ—Ä–¥ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
refreshDashboard();
// –í—ã–±–∏—Ä–∞–µ–º –∫—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
selectColor('red');

// –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
setInterval(refreshDashboard, 5000);
</script>
</body>
</html>
