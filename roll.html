<!DOCTYPE html> 
<html lang="ru"> 
<head> 
<meta charset="UTF-8">
<title>–ö—Ä–µ–º—É–∞ | –õ–æ—Ç–µ—Ä–µ—è</title> 
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="icon" href="https://github.com/cakeboxdeveloper/kremua/raw/refs/heads/main/AIcon.ico" type="image/x-icon">

<style>
body {  
  margin: 0; 
  font-family: Arial, sans-serif;  
  background: #17212b;
  color: white;
  overflow-x: hidden;
  overflow-y: auto;
  touch-action: pan-y pinch-zoom;
  -webkit-overflow-scrolling: touch;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
}

 /* ===== FIX –î–õ–Ø CANVAS - –î–û–î–ê–ô –¶–ï –í <style> =====*/
#particleCanvas,
#confetti-container {
  position: fixed;
  inset: 0;
  pointer-events: none;
  /* üëá –í–ê–ñ–õ–ò–í–û: —Å–∫–∞—Å–æ–≤—É—î–º–æ zoom –¥–ª—è canvas */
  zoom: 1 !important;
  -moz-transform: scale(1) !important;
  width: 100vw !important;
  height: 100vh !important;
}

/* ===== –ê–î–ê–ü–¢–ò–í–ù–ï –ú–ê–°–®–¢–ê–ë–£–í–ê–ù–ù–Ø –î–õ–Ø –î–ï–°–ö–¢–û–ü–ê ===== */
@media (min-width: 769px) {
  body {
    zoom: 0.85;
    -moz-transform: scale(0.85);
    -moz-transform-origin: 0 0;
  }
  
  /* üëá –î–û–î–ê–õ–ò: canvas –Ω–µ –º–∞—Å—à—Ç–∞–±—É—é—Ç—å—Å—è */
  #particleCanvas,
  #confetti-container,
  #fuseCanvas {
    zoom: 1 !important;
    -moz-transform: scale(1) !important;
  }
}

@media (min-width: 1200px) {
  body {
    zoom: 0.9;
    -moz-transform: scale(0.9);
  }
}

@media (min-width: 1600px) {
  body {
    zoom: 1;
    -moz-transform: scale(1);
  }
}

.tap-hint {
  position: fixed;  
  top: 70%;         /* üëà –¶–ï–ù–¢–† –≠–ö–†–ê–ù–ê –ü–û –í–ï–†–¢–ò–ö–ê–õ–ò */
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 10001;   /* üëà –í–´–®–ï .loader (—É –Ω–µ–≥–æ 9999) */
  pointer-events: none;
  width: 100px;      /* üëà –£–ú–ï–ù–¨–®–ò–õ –î–û 60px */
  height: 100px;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.tap-hint.visible {
  opacity: 1;
}


  #fuseCanvas {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 10002; /* üëà –í—ã—à–µ –≤—Å–µ—Ö */
}

.tap-hint img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  filter: none;   
  animation: pulse-hint 1.5s ease-in-out infinite;
  display: block;
}

  @keyframes pulse-hint {
  0% {
    transform: translateX(-20px) rotate(-10deg);
  }
  25% {
    transform: translateX(0px) rotate(0deg); /* üëà –¶–µ–Ω—Ç—Ä –±–µ–∑ –Ω–∞–∫–ª–æ–Ω–∞ */
  }
  50% {
    transform: translateX(30px) rotate(15deg);
  }
  75% {
    transform: translateX(0px) rotate(0deg); /* üëà –¶–µ–Ω—Ç—Ä –±–µ–∑ –Ω–∞–∫–ª–æ–Ω–∞ */
  }
  100% {
    transform: translateX(-20px) rotate(-10deg);
  }
}


.loader-text {
  font-size: 18px;
  color: #d4af37;
  margin-top: 10px;
  animation: pulse 1.5s ease-in-out infinite;
  text-align: center; /* üëà –î–û–ë–ê–í–¨ –≠–¢–£ –°–¢–†–û–ö–£ */
  width: 90%;
  max-width: 600px;
}


/* üëá –î–û–ë–ê–í–¨ –û–¢–°–Æ–î–ê */
/* ===== –¢–ê–ë–õ–ò–¶–ê –ö–£–ü–û–ù–û–í –ù–ê–î –†–£–õ–ï–¢–ö–û–ô ===== */
.coupons-table {
  margin-bottom: 30px;
  background: #1d2b3a;
  border: 1px solid #6ab2f2;
  border-radius: 8px;
  overflow: hidden;
  max-width: 400px;
  width: 90%;
}

.coupons-table table {
  width: 100%;
  border-collapse: collapse;
}

.coupons-table thead {
  background: #22364a;
}

.coupons-table th {
  padding: 12px 16px;
  text-align: center;
  font-size: 15px;
  font-weight: 700;
  color: #6ab2f2;
  border-bottom: 2px solid #6ab2f2;
}

.coupons-table td {
  padding: 10px 16px;
  font-size: 14px;
  font-weight: 600;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.coupons-table tbody tr:last-child td {
  border-bottom: none;
}

.coupons-table tbody tr {
  transition: background 0.2s ease, transform 0.2s ease;
}

.coupons-table tbody tr:hover {
  transform: scale(1.02);
}

.coupon-name {
  display: flex;
  align-items: center;
  gap: 8px;
}

.coupon-icon {
  width: 24px;
  height: 24px;
  flex-shrink: 0;
}

.coupon-discount {
  font-weight: 700;
  text-align: right;
  white-space: nowrap;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–æ–∫ —Ä–∞–∑–Ω—ã—Ö –∫—É–ø–æ–Ω–æ–≤ */
/* 1. –£–ë–ò–†–ê–ï–ú –ó–ê–õ–ò–í–ö–£ –°–¢–†–û–ö –í –¢–ê–ë–õ–ò–¶–ï - –∑–∞–º–µ–Ω–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ */
.coupons-table tbody tr.green-coupon {
  background: transparent;
  color: #6af27d;
}

.coupons-table tbody tr.green-coupon:hover {
  background: rgba(29, 58, 34, 0.3);
}

.coupons-table tbody tr.yellow-coupon {
  background: transparent;
  color: #f7a632;
}

.coupons-table tbody tr.yellow-coupon:hover {
  background: rgba(68, 54, 33, 0.3);
}

.coupons-table tbody tr.blue-coupon {
  background: transparent;
  color: #6ab2f2;
}

.coupons-table tbody tr.blue-coupon:hover {
  background: rgba(29, 43, 58, 0.3);
}

.coupons-table tbody tr.red-coupon {
  background: transparent;
  color: #f27db0;
}

.coupons-table tbody tr.red-coupon:hover {
  background: rgba(58, 29, 43, 0.3);
}

/* 3. –°–¢–ò–õ–ò –î–õ–Ø "–ú–û–ò –ö–£–ü–û–ù–´" */
 .my-coupons-container {
  width: 90%;
  max-width: 400px;
  background: #1d2b3a;
  border-radius: 6px;
  padding: 16px;
  margin: 0 auto 20px;
  flex-shrink: 0;
  box-sizing: border-box;
  position: relative;
  --coupon-border-color: #6ab2f2;
  --burn-progress: 0;
  
  /* üî• –£–ë–†–ê–õ–ò border –æ—Ç—Å—é–¥–∞ - –æ–Ω –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ –≤ ::before */
}

.my-coupons-container::before {
  content: '';
  position: absolute;
  inset: -2px;
  border-radius: 8px;
  pointer-events: none;
  z-index: 0;
  
  /* üî• –í–ï–†–ù–£–õ–ò: –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –°–í–ï–†–•–£ (-90deg) –∏ –∏–¥—ë—Ç –ø–æ —á–∞—Å–æ–≤–æ–π */
  background: conic-gradient(
    from 0deg,
    transparent 0deg,
    transparent calc(var(--burn-progress) * 3.6deg),
    var(--coupon-border-color) calc(var(--burn-progress) * 3.6deg),
    var(--coupon-border-color) 360deg
  );
  
  /* –ú–∞—Å–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∞ —Ä–∞–º–∫–∏ */
  -webkit-mask: 
    linear-gradient(#fff 0 0) content-box, 
    linear-gradient(#fff 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
  padding: 2px;
}

.my-coupons-header {
  font-size: clamp(12px, 3vw, 16px);
  font-weight: 600;
  color: #6ab2f2;
  margin-bottom: 12px;
  text-align: center;
  opacity: 0.9;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.coupon-timer {
  font-size: clamp(12px, 3vw, 16px);
  font-weight: 700;
  color: #6ab2f2;
  font-family: Arial, sans-serif;
  letter-spacing: 1px;
}

.my-coupons-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
  position: relative;
  z-index: 2;
}

.my-coupon-item.copied {
  background: var(--coupon-color);
  border-color: var(--coupon-color);
}

.my-coupon-item.copied .my-coupon-code {
  color: #17212b !important;
}

.my-coupon-item {
  background: transparent;
  border: 2px solid;
  border-radius: 4px;
  padding: 10px 12px;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  transition: all 0.2s ease;
}

.my-coupon-code {
  font-family: monospace;
  font-size: clamp(16px, 4vw, 20px); /* üëà –ò–ó–ú–ï–ù–ò–õ–ò: –±—ã–ª–æ 15px, —Å—Ç–∞–ª–æ 16-20px */
  font-weight: 900;
  letter-spacing: 0.5px;
  width: 100%;
  text-align: center;
  white-space: nowrap; /* üëà –£–ñ–ï –ï–°–¢–¨ - –Ω–µ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è */
  overflow: hidden; /* üëà –î–û–ë–ê–í–ò–õ–ò - –æ–±—Ä–µ–∑–∞–µ—Ç –µ—Å–ª–∏ –Ω–µ –≤–ª–µ–∑–∞–µ—Ç */
  text-overflow: ellipsis; /* üëà –î–û–ë–ê–í–ò–õ–ò - –¥–æ–±–∞–≤–ª—è–µ—Ç ... –µ—Å–ª–∏ –¥–ª–∏–Ω–Ω—ã–π */
}

.my-coupon-discount {
  display: none;
}

.my-coupons-empty {
  text-align: center;
  color: rgba(255, 255, 255, 0.5);
  font-size: 14px;
  padding: 20px;
}
  

/* ‚úÖ –ê–î–ê–ü–¢–ò–í–ù–û–ï –ú–ê–°–®–¢–ê–ë–ò–†–û–í–ê–ù–ò–ï –î–õ–Ø –î–ï–°–ö–¢–û–ü–ê */
@media (min-width: 769px) {
  body {
    zoom: 0.85; /* –£–º–µ–Ω—å—à–∞–µ–º –¥–æ 85% */
    -moz-transform: scale(0.85);
    -moz-transform-origin: 0 0;
  }
}

@media (min-width: 1200px) {
  body {
    zoom: 0.9; /* –î–ª—è –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ 90% */
    -moz-transform: scale(0.9);
  }
}

@media (min-width: 1600px) {
  body {
    zoom: 1; /* –ù–∞ –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö 100% */
    -moz-transform: scale(1);
  }
}
* {
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
}

/* ===== –ü–†–ï–õ–û–ê–î–ï–† (–ü–ï–°–û–ß–ù–´–ï –ß–ê–°–´) ===== */
.preloader {
  position: fixed;
  inset: 0;
  background: #17212b;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  opacity: 1;
  pointer-events: all;
  transition: opacity 0.5s ease;
}

.preloader.hidden {
  opacity: 0;
  pointer-events: none;
}

.preloader img {
  width: 120px;
  height: 120px;
  object-fit: contain;
}

.preloader-text {
  font-size: 16px;
  color: #d4af37;
  margin-top: 15px;
  animation: pulse 1.5s ease-in-out infinite;
  text-align: center; /* üëà –î–û–ë–ê–í–¨ –≠–¢–£ –°–¢–†–û–ö–£ */
  width: 90%;
  max-width: 600px;
}

/* ===== –õ–û–ê–î–ï–† (–†–£–õ–ï–¢–ö–ê) ===== */
.loader {
  position: fixed;
  inset: 0;
  background: #17212b;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  opacity: 0;                    /* üëà –ò–ó–ú–ï–ù–ò–õ–ò: –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ–≤–∏–¥–∏–º */
  pointer-events: none;          /* üëà –ò–ó–ú–ï–ù–ò–õ–ò: –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω */
  transition: opacity 0.5s ease;
}

.loader.visible {                /* üëà –î–û–ë–ê–í–ò–õ–ò: –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –ø–æ–∫–∞–∑–∞ */
  opacity: 1;
  pointer-events: all;
}

.loader.hidden {
  opacity: 0;
  pointer-events: none;
}

.loader img { 
  width: 1000px; 
  height: 150px;
  margin-bottom: 20px;
  object-fit: cover;
  object-position: center;
  max-width: 90vw;
  mask-image: linear-gradient(
    to right,
    transparent 0%,
    black 25%,
    black 75%,
    transparent 100%
  );
  -webkit-mask-image: linear-gradient(
    to right,
    transparent 0%,
    black 25%,
    black 75%,
    transparent 100%
  );
}
 
.loader-text {
  font-size: 18px;
  color: #d4af37;  /* üëà –∏–∑–º–µ–Ω–∏–ª–∏ –Ω–∞ –∑–æ–ª–æ—Ç–æ–π */
  margin-top: 10px;
  animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

/* ===== –ü–†–û–ú–û–ö–û–î –û–í–ï–†–õ–ï–ô ===== */
.promo-overlay {
  position: fixed;
  inset: 0;
  background: transparent;
  backdrop-filter: blur(50px);
  -webkit-backdrop-filter: blur(50px);
  z-index: 8888;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease;
}

.promo-overlay.active {
  opacity: 1;
  pointer-events: all;
}

#particleCanvas {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 8889;
}

#confetti-container {
  position: fixed;
  inset: 0;
  pointer-events: none;
  overflow: hidden;
  z-index: 8890;
}

.promo-card {
  background: transparent;
  border: none;
  max-width: 512px;
  width: 90%;
  text-align: center;
  position: relative;
  transform: scale(0.9);
  transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  padding: 0 16px;
}

@keyframes gentle-sway {
  0%, 100% {
    transform: scale(1) rotate(-1deg);
  }
  50% {
    transform: scale(1) rotate(1deg);
  }
}

.promo-overlay.active .promo-card {
  transform: scale(1);
}

.promo-title {
  font-size: clamp(16px, 5vw, 22px);
  font-weight: 700;
  color: #ffffff;      /* üëà –ò–ó–ú–ï–ù–ò–õ–ò –Ω–∞ –±–µ–ª—ã–π */
  margin-bottom: 8px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.promo-hint {
  font-size: 18px;
  color: #ffffff;      /* üëà –ò–ó–ú–ï–ù–ò–õ–ò –Ω–∞ –±–µ–ª—ã–π */
  margin-bottom: 10px;
  opacity: 0.9;
}

  /* ===== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ë–ò–õ–ï–¢–ê ===== */
.ticket-modal {
  position: fixed;
  inset: 0;
  background: #17212b; /* üëà –ò–ó–ú–ï–ù–ò–õ–ò: –ø–æ—á—Ç–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω */
  backdrop-filter: blur(20px); /* üëà –ò–ó–ú–ï–ù–ò–õ–ò: —Å–∏–ª—å–Ω–µ–µ –±–ª—é—Ä */
  -webkit-backdrop-filter: blur(20px);
  z-index: 99999;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}

/* üëá –î–û–ë–ê–í–¨ –≠–¢–ò –°–¢–ò–õ–ò –î–õ–Ø –ö–†–ê–°–ù–û–ì–û –°–í–ï–ß–ï–ù–ò–Ø */
.ticket-modal.error .ticket-modal-icon::before {
  content: '';
  position: absolute;
  inset: -10px;
  background: 
    radial-gradient(
      circle,
      rgba(231, 76, 60, 0.4) 0%,
      rgba(231, 76, 60, 0.3) 20%,
      rgba(231, 76, 60, 0.15) 40%,
      rgba(231, 76, 60, 0.05) 60%,
      transparent 80%
    );
  border-radius: 50%;
  animation: pulseGlow 3s ease-in-out infinite;
  z-index: -1;
  opacity: 1; /* üëà –í—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º–æ–µ –¥–ª—è error */
  transition: opacity 0.6s ease;
  filter: blur(3px);
}

/* üëá –î–û–ë–ê–í–¨ –≠–¢–û - —É–±–µ–¥–∏—Å—å —á—Ç–æ –∑–æ–ª–æ—Ç–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è success */
.ticket-modal.success .ticket-modal-icon::before {
  content: '';
  position: absolute;
  inset: -5px;
  background: 
    radial-gradient(
      circle,
      rgba(212, 175, 55, 0.4) 0%,
      rgba(212, 175, 55, 0.3) 20%,
      rgba(212, 175, 55, 0.15) 40%,
      rgba(212, 175, 55, 0.05) 60%,
      transparent 80%
    );
  border-radius: 50%;
  animation: pulseGlow 3s ease-in-out infinite;
  z-index: -1;
  opacity: 1;
  transition: opacity 0.6s ease;
  filter: blur(2px);
}

.ticket-modal.active {
  opacity: 1;
  pointer-events: all;
}

.ticket-modal-content {
  background: #3a2d1d;
  border: 2px solid #d4af37;
  border-radius: 12px;
  padding: 30px;
  max-width: 400px;
  width: 80%;
  text-align: center;
  transform: scale(0.9);
  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.ticket-modal.active .ticket-modal-content {
  transform: scale(1);
}
  .ticket-modal.error .ticket-modal-content {
  border: 2px solid #e74c3c;
}
.ticket-modal.error .ticket-modal-content {
  background: #3a1d1d;
  border: 2px solid #e74c3c;
}

.ticket-modal.error .ticket-modal-text {
  color: #e74c3c;
}
.ticket-modal-icon {
  width: 160px;
  height: 160px;
  margin: 0 auto 20px;
  font-size: 64px;
  line-height: 80px;
  position: relative;
}

 .ticket-modal-icon::before {
  content: '';
  position: absolute;
  inset: -20px;
  background: 
    radial-gradient(
      circle,
      rgba(212, 175, 55, 0.4) 0%,
      rgba(212, 175, 55, 0.3) 20%,
      rgba(212, 175, 55, 0.15) 40%,
      rgba(212, 175, 55, 0.05) 60%,
      transparent 80%
    );
  border-radius: 50%;
  animation: pulseGlow 3s ease-in-out infinite;
  z-index: -1;
  opacity: 0;
  transition: opacity 0.6s ease;
  filter: blur(5px);
}

/* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∏—è–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è success */
.ticket-modal.success .ticket-modal-icon::before {
  opacity: 1;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –ø—É–ª—å—Å–∞—Ü–∏–∏ */
@keyframes pulseGlow {
  0%, 100% {
    transform: scale(1);
    opacity: 0.8;
  }
  50% {
    transform: scale(1.1);
    opacity: 1;
  }
}

    
  
/* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª—É—á–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è success */
.ticket-modal.success .ticket-modal-icon::before {
  opacity: 1;
}

 

/* –ö–∞—Ä—Ç–∏–Ω–∫–∞ –±–∏–ª–µ—Ç–∞ –ø–æ–≤–µ—Ä—Ö –ª—É—á–µ–π */
.ticket-modal-icon img {
  position: relative;
  z-index: 1;
}

.ticket-modal-text {
  font-size: 18px;
  color: #ffffff;
  margin-bottom: 25px;
  line-height: 1.5;
}
  

.ticket-modal.success .ticket-modal-text {
  color: #d4af37;
}

.ticket-modal-btn {
  padding: 12px 40px;
  background: #3a2d1d;
  border: 1px solid #d4af37;
  color: #d4af37;
  border-radius: 6px;
  font-weight: 600;
  font-size: 16px;
  cursor: pointer;
  transition: transform 0.15s ease;
}

.ticket-modal-btn:active {
  transform: scale(0.96);
}

.ticket-modal-btn.error {
  background: #3a1d1d;
  border: 1px solid #e74c3c;
  color: #e74c3c;
}

.promo-image-wrapper {
  position: relative;
  width: 100%;
  background: transparent;
  aspect-ratio: 2 / 1;
  max-width: 600px;
  margin: 0 auto;
  animation: gentle-sway 4s ease-in-out infinite;
  mask-image: url('https://raw.githubusercontent.com/CakeBoxDeveloper/kremua/5793408ec6209b2e840db457f59ebd2e38c43c19/CPNSVG11.svg');
  -webkit-mask-image: url('https://raw.githubusercontent.com/CakeBoxDeveloper/kremua/5793408ec6209b2e840db457f59ebd2e38c43c19/CPNSVG11.svg');
  mask-size: 100% 100%;
  -webkit-mask-size: 100% 100%;
 
  mask-position: calc(50% - 1.5px) center;
  -webkit-mask-position: calc(50% - 1.5px) center;
   

  
  mask-repeat: no-repeat;
  -webkit-mask-repeat: no-repeat;
}

.promo-base-svg {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: contain;
  z-index: 1;
}

.promo-animation-webm {
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  object-fit: contain;
  z-index: 2;
  mix-blend-mode: normal;
  transform: scale(1.08);
}

  .promo-animation-webm {
  display: none; /* –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
}

.promo-animation-webm.active {
  display: block; /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω–æ–µ */
}

.promo-code-box {
  position: absolute;
  top: 85%;
  left: 15%;
  width: 100%;
  transform: translateY(-50%);
  background: transparent;
  border: none;
  padding: 0;
  z-index: 3;
  font-size: clamp(14px, 3.5vw, 20px);
  font-weight: 900;
  letter-spacing: 0.5px;
  text-align: center;
  cursor: pointer;
  user-select: none;
  transition: all 0.2s ease;
}

.promo-code-box:hover {
  transform: translateY(-50%) scale(1.05);
}

.promo-code-box:active {
  transform: translateY(-50%) scale(0.98);
}

.promo-shimmer {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 4;
  pointer-events: none;
  overflow: hidden;
}

.promo-shimmer::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(
    90deg,
    rgba(255, 255, 255, 0) 0%,
    rgba(255, 255, 255, 0.03) 45%,
    rgba(255, 255, 255, 0.15) 50%,
    rgba(255, 255, 255, 0.03) 55%,
    rgba(255, 255, 255, 0) 100%
  );
  animation: shimmer-sweep 3s ease-in-out infinite;
  transform: skewX(-20deg);
}

@keyframes shimmer-sweep {
  0% {
    transform: translateX(-100%) skewX(-20deg);
  }
  100% {
    transform: translateX(100%) skewX(-20deg);
  }
}

 


/* ===== –§–ò–ù–ê–õ–¨–ù–´–ô –≠–ö–†–ê–ù ===== */
.final-screen {
  position: fixed;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  padding: 20px;
  padding-top: 10px; /* üëà –ò–ó–ú–ï–ù–ò–õ–ò: –±—ã–ª–æ 20px, —Å—Ç–∞–ª–æ 10px (–µ—â—ë –≤–¥–≤–æ–µ –º–µ–Ω—å—à–µ) */
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.5s ease;
  z-index: 8887;
  overflow-y: auto;
}

.final-screen.visible {
  opacity: 1;
  pointer-events: all;
}

.final-avatar {
  width: 75%;
  max-width: 384px;
  margin-bottom: 5px; /* üëà –ò–ó–ú–ï–ù–ò–õ–ò: –±—ã–ª–æ 10px, —Å—Ç–∞–ª–æ 5px (–µ—â—ë –≤–¥–≤–æ–µ –º–µ–Ω—å—à–µ) */
  position: relative;
  left: 20px;
  flex-shrink: 0;
}

  
.countdown-container {
  background: #1d2b3a;
  border: 1px solid #6ab2f2;
  border-radius: 4px;
  text-align: center;
  max-width: 400px;
  width: 90%;
  padding: 12px 16px;
  box-sizing: border-box; /* üëà –î–û–ë–ê–í–ò–õ–ò */
}

.countdown-text {
  font-size: clamp(13px, 3.5vw, 16px); /* üëà –£–í–ï–õ–ò–ß–ò–õ–ò: –±—ã–ª–æ 10-14px, —Å—Ç–∞–ª–æ 13-16px */
  color: #6ab2f2;
  line-height: 1.6;
  margin-bottom: 0;
  margin-top: 0;
  font-weight: 600;
  font-family: Arial, sans-serif;
  letter-spacing: 1px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  display: inline;
}

.countdown-timer {
  font-size: clamp(13px, 3.5vw, 16px); /* üëà –£–í–ï–õ–ò–ß–ò–õ–ò: –±—ã–ª–æ 10-14px, —Å—Ç–∞–ª–æ 13-16px */
  font-weight: 600;
  color: #6ab2f2;
  font-family: Arial, sans-serif;
  letter-spacing: 1px;
  margin: 0;
  display: inline;
  margin-left: 6px;
}

.shop-btn {
  display: inline-flex;  /* üëà –ë–´–õ–û inline-block */
  align-items: center;   /* üëà –î–û–ë–ê–í–õ–ï–ù–û */
  justify-content: center;  /* üëà –î–û–ë–ê–í–õ–ï–ù–û */
  margin-top: 20px;
  padding: 14px 32px;
  background: #1d3a22;
  border: 1px solid #6af27d;
  color: #6af27d;
  border-radius: 6px;
  font-weight: 600;
  text-decoration: none;
  transition: transform 0.15s ease, background 0.3s ease;
  max-width: 400px;  /* üëà –î–û–ë–ê–í–õ–ï–ù–û - —Ç–∞–∫–∞—è –∂–µ —à–∏—Ä–∏–Ω–∞ –∫–∞–∫ —É —Ç–∞–π–º–µ—Ä–∞ */
  width: 90%;        /* üëà –î–û–ë–ê–í–õ–ï–ù–û */
  box-sizing: border-box;  /* üëà –î–û–ë–ê–í–õ–ï–ù–û */
}

.shop-btn img {
  vertical-align: middle;  /* üëà –î–û–ë–ê–í–õ–ï–ù–û */
}
  

 

@media (max-width: 480px) {
  .promo-title {
    font-size: 16px;
  }
  
  .promo-hint {
    font-size: 12px;
  }
  
  .promo-code-box {
    font-size: clamp(14px, 2.8vw, 20px);
  }
}


  /* ===== –í–ò–î–ñ–ï–¢ –í–´–ò–ì–†–´–®–ï–ô ===== */
/* ===== –í–ò–î–ñ–ï–¢ –í–´–ò–ì–†–´–®–ï–ô ===== */
/* ===== –í–ò–î–ñ–ï–¢ –í–´–ò–ì–†–´–®–ï–ô ===== */
.winners-widget {
  width: 90%;
  max-width: 400px;
  height: 180px;
  background: #1d2b3a;
  color: #6ab2f2;
  font-family: Arial, sans-serif;
  border-radius: 6px;
  padding: 0;
  overflow: hidden;
  margin: 0 auto 20px;  /* üëà –ò–ó–ú–ï–ù–ò–õ–ò: —É–±—Ä–∞–ª–∏ –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É */
  position: relative;
  z-index: 10;  /* üëà –î–û–ë–ê–í–õ–ï–ù–û - –≤–∏–¥–∂–µ—Ç –ø–æ–≤–µ—Ä—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö */
   flex-shrink: 0;  /* üëà –î–û–ë–ê–í–¨ –≠–¢–£ –°–¢–†–û–ö–£ */
  
/* –ì–†–ê–î–ò–ï–ù–¢ –°–í–ï–†–•–£ –ò –°–ù–ò–ó–£ */
mask-image: linear-gradient(
  to bottom,
  transparent 0%,
  black 20%,
  black 80%,
  transparent 100%
);
-webkit-mask-image: linear-gradient(
  to bottom,
  transparent 0%,
  black 20%,
  black 80%,
  transparent 100%
);
}

  #fuseCanvas {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 10002; /* üëà –ò–ó–ú–ï–ù–ò–õ–ò: –±—ã–ª–æ 1, —Å—Ç–∞–ª–æ 10002 (–≤—ã—à–µ –≤—Å–µ—Ö) */
}

.winners-widget ul {
  list-style: none;
  padding: 0;
  margin: 0;
  will-change: transform;
  width: 100%;
  position: absolute;
  top: 0;
  left: 0;
}

.winners-widget li {
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 16px;
  font-size: 14px;
  border-bottom: 1px solid rgba(255,255,255,0.07);
  box-sizing: border-box;
  background: #1d2b3a;  /* üëà –î–û–ë–ê–í–õ–ï–ù–û - —Ñ–æ–Ω –¥–ª—è —Å—Ç—Ä–æ–∫ */
}

.winner-id {
  color: #ffffff;
  font-weight: 600;
}

.winner-coupon {
  color: #6ab2f2;
  font-weight: 500;
}
</style>
</head>
<body>

<!-- –ü–†–ï–õ–û–ê–î–ï–† (–ü–ï–°–û–ß–ù–´–ï –ß–ê–°–´) -->
<div id="preloader" class="preloader">
  <img src="https://github.com/cakeboxdeveloper/kremua/blob/main/LowWebpSlotQQ.webp?raw=true" alt="–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è">
  <div class="preloader-text">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
</div>

<!-- –õ–û–ê–î–ï–† (–†–£–õ–ï–¢–ö–ê) -->
<!-- –ó–º—ñ–Ω—é—î–º–æ —Å—Ç–∏–ª—ñ –¥–ª—è .tap-hint -->
<style>
/* ... —ñ–Ω—à—ñ —Å—Ç–∏–ª—ñ ... */

 

/* ... —ñ–Ω—à—ñ —Å—Ç–∏–ª—ñ ... */

/* üëá –î–û–î–ê–Ñ–ú–û –ù–û–í–ò–ô –°–¢–ò–õ–¨ –î–õ–Ø –ü–û–ó–ò–¶–Ü–û–ù–£–í–ê–ù–ù–Ø –í–Ü–î–ù–û–°–ù–û WEBM */
.loader {
  position: fixed;
  inset: 0;
  background: #17212b;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.5s ease;
}

.loader-content-wrapper {
  position: relative;  /* üëà –í–ê–ñ–ù–û: —Ä–æ–¥–∏—Ç–µ–ª—å —Å relative */
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 1000px;      /* üëà –î–û–ë–ê–í–ò–õ–ò: —à–∏—Ä–∏–Ω–∞ –∫–∞–∫ —É WEBM */
  max-width: 90vw;    /* üëà –î–û–ë–ê–í–ò–õ–ò: –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
}
.loader-content-wrapper > img {
  width: 100%;
  height: 150px;
  object-fit: cover;
  object-position: center;
  mask-image: linear-gradient(
    to right,
    transparent 0%,
    black 25%,
    black 75%,
    transparent 100%
  );
  -webkit-mask-image: linear-gradient(
    to right,
    transparent 0%,
    black 25%,
    black 75%,
    transparent 100%
  );
}

/* ... —ñ–Ω—à—ñ —Å—Ç–∏–ª—ñ ... */
</style>

<!-- –ó–º—ñ–Ω—é—î–º–æ HTML –ª–æ–∞–¥–µ—Ä–∞ -->
<div id="loader" class="loader">
  <div class="coupons-table">
    <table>
      <thead>
        <tr>
          <th colspan="2">–©–æ –º–æ–∂–Ω–∞ –≤–∏–≥—Ä–∞—Ç–∏?</th>
        </tr>
      </thead>
      <tbody>
        <!-- –ó–µ–ª—ë–Ω–∏–π –∫—É–ø–æ–Ω -->
        <tr class="green-coupon">
          <td>
            <div class="coupon-name">
    <svg class="coupon-icon" viewBox="0 0 100 50" xmlns="http://www.w3.org/2000/svg">
  <rect width="100" height="50" fill="#005330" rx="4"/>
  <circle cx="0" cy="25" r="8" fill="#1d3a22"/>
  <circle cx="100" cy="25" r="8" fill="#1d3a22"/>
</svg>
              <span>–ó–µ–ª–µ–Ω–∏–π –∫—É–ø–æ–Ω</span>
            </div>
          </td>
          <td class="coupon-discount">–∑–Ω–∏–∂–∫–∞ 150 –≥—Ä–Ω</td>
        </tr>
        
        <!-- –ñ—ë–ª—Ç—ã–π –∫—É–ø–æ–Ω -->
        <tr class="yellow-coupon">
          <td>
            <div class="coupon-name">
   <svg class="coupon-icon" viewBox="0 0 100 50" xmlns="http://www.w3.org/2000/svg">
  <rect width="100" height="50" fill="#af8246" rx="4"/>
  <circle cx="0" cy="25" r="8" fill="#443621"/>
  <circle cx="100" cy="25" r="8" fill="#443621"/>
</svg>
              <span>–ñ–æ–≤—Ç–∏–π –∫—É–ø–æ–Ω</span>
            </div>
          </td>
          <td class="coupon-discount">–∑–Ω–∏–∂–∫–∞ 25%</td>
        </tr>
        
        <!-- –°–∏–Ω–∏–π –∫—É–ø–æ–Ω -->
        <tr class="blue-coupon">
          <td>
            <div class="coupon-name">
 <svg class="coupon-icon" viewBox="0 0 100 50" xmlns="http://www.w3.org/2000/svg">
  <rect width="100" height="50" fill="#5c94cc" rx="4"/>
  <circle cx="0" cy="25" r="8" fill="#1d2b3a"/>
  <circle cx="100" cy="25" r="8" fill="#1d2b3a"/>
</svg>
              <span>–°–∏–Ω—ñ–π –∫—É–ø–æ–Ω</span>
            </div>
          </td>
          <td class="coupon-discount">–∑–Ω–∏–∂–∫–∞ 50%</td>
        </tr>
        
        <!-- –ö—Ä–∞—Å–Ω—ã–π –∫—É–ø–æ–Ω -->
        <tr class="red-coupon">
          <td>
            <div class="coupon-name">
<svg class="coupon-icon" viewBox="0 0 100 50" xmlns="http://www.w3.org/2000/svg">
  <rect width="100" height="50" fill="#6d2121" rx="4"/>
  <circle cx="0" cy="25" r="8" fill="#3a1d1d"/>
  <circle cx="100" cy="25" r="8" fill="#3a1d1d"/>
</svg>
              <span>–ß–µ—Ä–≤–æ–Ω–∏–π –∫—É–ø–æ–Ω</span>
            </div>
          </td>
          <td class="coupon-discount">–±–æ–Ω—É—Å–Ω–∏–π —Ç–æ—Ä—Ç</td>
        </tr>
      </tbody>
    </table>
  </div>
  
<!-- üëá –ù–û–í–ò–ô –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø WEBM + –ù–ê–î–ü–ò–°–£ -->
<div class="loader-content-wrapper">
    <img src="https://github.com/cakeboxdeveloper/kremua/blob/main/RollingAnim.webp?raw=true" alt="–†—É–ª–µ—Ç–∫–∞">
  </div>
  
  <div class="loader-text">–ì–µ–Ω–µ—Ä—É—î–º–æ –≤–∞—à –ø—Ä–æ–º–æ–∫–æ–¥...</div>
</div>

<!-- üëá –í–´–ù–ï–°–ò –°–Æ–î–ê - –ó–ê –ü–†–ï–î–ï–õ–´ .loader -->
<div class="tap-hint" id="tapHint">
  <img src="https://github.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/blob/main/People/Backhand%20Index%20Pointing%20Up.webp?raw=true" alt="Tap">
</div>
  

<!-- –ü–†–û–ú–û–ö–û–î –û–í–ï–†–õ–ï–ô -->
<canvas id="particleCanvas"></canvas>
<canvas id="confetti-container"></canvas>
<div id="promoOverlay" class="promo-overlay">
  <div class="promo-card" id="promoCard" onclick="event.stopPropagation()">
    <div class="promo-title" id="promoTitle">–í—ñ—Ç–∞—î–º–æ! –û—Å—å –≤–∞—à –ø—Ä–æ–º–æ–∫–æ–¥!</div>
    <div class="promo-hint">—à–≤–∏–¥—à–µ —Ç–∏—Å–Ω–∏ –Ω–∞ –ø—Ä–æ–º–æ–∫–æ–¥, —â–æ–± —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –π–æ–≥–æ</div>
    <div class="promo-image-wrapper">
      <img 
        src="https://raw.githubusercontent.com/cakeboxdeveloper/kremua/78ef867be64454e2ba264502e940f68f684cc588/CPNSVG15StaticCurvesClean.svg" 
        class="promo-base-svg"
        alt="Base"
      >
      
  <video 
  class="promo-animation-webm promo-video-yellow" 
  src="https://raw.githubusercontent.com/cakeboxdeveloper/kremua/main/LowY2.mp4"
  loop 
  muted 
  playsinline 
  preload="metadata">
</video>

<video 
  class="promo-animation-webm promo-video-red" 
  src="https://raw.githubusercontent.com/cakeboxdeveloper/kremua/main/LowR2.mp4"
  loop 
  muted 
  playsinline 
  preload="metadata">
</video>

<video 
  class="promo-animation-webm promo-video-blue" 
  src="https://raw.githubusercontent.com/cakeboxdeveloper/kremua/main/LowB2.mp4"
  loop 
  muted 
  playsinline 
  preload="metadata">
</video>

<video 
  class="promo-animation-webm promo-video-green" 
  src="https://raw.githubusercontent.com/cakeboxdeveloper/kremua/main/LowG2.mp4"
  loop 
  muted 
  playsinline 
  preload="metadata">
</video>
      
      <div class="promo-code-box" id="promoCode" onclick="copyPromoCode(event)">
        XXXX-XXXX-XXXX-XXXX
      </div>
      
      <div class="promo-shimmer"></div>
    </div>
  </div>
</div>

<!-- –§–ò–ù–ê–õ–¨–ù–´–ô –≠–ö–†–ê–ù –° –¢–ê–ô–ú–ï–†–û–ú -->
<div id="finalScreen" class="final-screen">
  <video autoplay loop muted playsinline class="final-avatar">
 
    <source src="https://cdn.jsdelivr.net/gh/cakeboxdeveloper/kremua@main/LowSlotQQ.webm" type="video/webm">
  </video>
   

<!-- üéØ HEADER –ü–û–î –ê–í–ê–¢–ê–†–û–ú -->
<div style="display: flex; flex-direction: column; gap: 8px; align-items: center; margin-top: 12px; margin-bottom: 5px;">
<div style="display: flex; align-items: center; gap: 6px; font-size: 16.5px; color: #d4af37; margin-bottom: 10px;">
  <span class="lottery-participants-count" data-target="843" style="font-weight: 700;">0</span>
  <span>—É—á–∞—Å–Ω–∏–∫—ñ–≤ –∫—Ä—É—Ç–∏–ª–∏ –∫–æ–ª–æ —Å—å–æ–≥–æ–¥–Ωi</span>
</div>
</div>
 

  <!-- –í–ò–î–ñ–ï–¢ –í–´–ò–ì–†–´–®–ï–ô -->
  <div class="winners-widget">
    <ul id="winnersList"></ul>
  </div>
 <!-- –ú–û–ò –ö–£–ü–û–ù–´ -->
<div class="my-coupons-container" id="myCouponsContainer">
  
  <div class="my-coupons-header">
    –¶–µ–π –∫—É–ø–æ–Ω —Å–∞–º–æ–∑–Ω–∏—â–∏—Ç—å—Å—è —á–µ—Ä–µ–∑: <span class="coupon-timer" id="couponTimer">02:00:00</span>
  </div>
  <div class="my-coupons-list" id="myCouponsList">
    <div class="my-coupons-empty">–¢—É—Ç –∑'—è–≤–ª—è—Ç—å—Å—è —Ç–≤–æ—ó –∫—É–ø–æ–Ω–∏</div>
  </div>
</div>

  <!-- üî• CANVAS –î–õ–Ø –ß–ê–°–¢–ò–¶ –§–ò–¢–ò–õ–Ø -->
<canvas id="fuseCanvas" style="position: fixed; inset: 0; pointer-events: none; z-index: 1;"></canvas>
   <!-- üî• –ú–ê–†–ö–ï–† "–ö–û–ù–ß–ò–ö–ê –§–ò–¢–ò–õ–Ø" -->
  <div class="fuse-marker" id="fuseMarker"></div>
   <!-- –¢–ê–ô–ú–ï–† -->
 <div class="countdown-container">
  <div style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
    <span class="countdown-text" id="countdownText">–ù–∞—Å—Ç—É–ø–Ω–∞ —Å–ø—Ä–æ–±–∞ —á–µ—Ä–µ–∑:</span>
    <span class="countdown-timer" id="countdownTimer">23:59:59</span>
  </div>
</div>
  
  <a href="index.html" class="shop-btn" id="shopBtn">
    <img src="https://raw.githubusercontent.com/lucide-icons/lucide/main/icons/grid-2x2.svg" style="width: 18px; height: 18px; margin-right: 6px; filter: brightness(0) saturate(100%) invert(78%) sepia(48%) saturate(426%) hue-rotate(72deg) brightness(98%) contrast(93%);">
    –í –º–∞–≥–∞–∑–∏–Ω
  </a>
</div>
  <audio id="preloaderSound" loop preload="auto">
  <source src="https://github.com/CakeBoxDeveloper/kremua/blob/main/Trig3.mp3" type="audio/mpeg">
</audio>

<audio id="rouletteSound" loop preload="auto">
  <source src="https://raw.githubusercontent.com/CakeBoxDeveloper/kremua/main/RLoop.mp3" type="audio/mpeg">
</audio>
  
<audio id="winSound" preload="auto">
  <source src="https://raw.githubusercontent.com/CakeBoxDeveloper/kremua/main/Win.mp3" type="audio/mpeg">
</audio>
<audio id="ticketSound" preload="auto">
  <source src="https://raw.githubusercontent.com/CakeBoxDeveloper/kremua/main/TicketKR.mp3" type="audio/mpeg">
</audio>
  

<script>
// ===== –ö–£–ü–û–ù–´ –° –†–ê–ó–ù–´–ú–ò –¶–í–ï–¢–ê–ú–ò –ò –í–ò–î–ï–û =====
const coupons = [
  {
    title: "–¢–æ–±i –≤–∏–ø–∞–≤ –∂–æ–≤—Ç–∏–π –∫—É–ø–æ–Ω!",
    videoUrl: "https://raw.githubusercontent.com/cakeboxdeveloper/kremua/main/LowY2.mp4",
    codeColor: "#af8246",
    particleColor: "#ffd282",
    discount: "15%",
    displayName: "–ñ–æ–≤—Ç–∏–π –∫—É–ø–æ–Ω"  // üëà –î–û–ë–ê–í–¨ –≠–¢–û
  },
  {
    title: "–¢–æ–±i –≤–∏–ø–∞–≤ —á–µ—Ä–≤–æ–Ω–∏–π –∫—É–ø–æ–Ω!",
    videoUrl: "https://raw.githubusercontent.com/cakeboxdeveloper/kremua/main/LowR2.mp4",
    codeColor: "#6d2121",
    particleColor: "#9c2d35",
    discount: "10%",
    displayName: "–ß–µ—Ä–≤–æ–Ω–∏–π –∫—É–ø–æ–Ω"  // üëà –î–û–ë–ê–í–¨ –≠–¢–û
  },
  {
    title: "–¢–æ–±i –≤–∏–ø–∞–≤ —Å–∏–Ω—ñ–π –∫—É–ø–æ–Ω!",
    videoUrl: "https://raw.githubusercontent.com/cakeboxdeveloper/kremua/main/LowB2.mp4",
    codeColor: "#5c94cc",
    particleColor: "#5c94cc",
    discount: "20%",
    displayName: "–°–∏–Ω—ñ–π –∫—É–ø–æ–Ω"  // üëà –î–û–ë–ê–í–¨ –≠–¢–û
  },
  {
    title: "–¢–æ–±i –≤–∏–ø–∞–≤ –∑–µ–ª–µ–Ω–∏–π –∫—É–ø–æ–Ω!",
    videoUrl: "https://raw.githubusercontent.com/cakeboxdeveloper/kremua/main/LowG2.mp4",
    codeColor: "#005330",
    particleColor: "#007042",
    discount: "50%",
    displayName: "–ó–µ–ª–µ–Ω–∏–π –∫—É–ø–æ–Ω"  // üëà –î–û–ë–ê–í–¨ –≠–¢–û
  }
];

  const predictions = [
  "–¶–µ–≥–ª–∞ –º–∞—î —Ñ–æ—Ä–º—É –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫–∞",
  "–í–∞—à–∞ –ª—ñ–≤–∞ —Ä—É–∫–∞ —Ü–µ –¥–∑–µ—Ä–∫–∞–ª—å–Ω–∞ –∫–æ–ø—ñ—è –ø—Ä–∞–≤–æ—ó",
  "–£ —Ñ—É—Ç–±–æ–ª—å–Ω–æ–≥–æ –º'—è—á–∞ –Ω–µ–º–∞—î –∂–æ–¥–Ω–æ–≥–æ –∫—É—Ç–∞",
  "–£ –í–µ–Ω–µ—Ü—ñ—ó –Ω–µ–º–∞—î –∂–æ–¥–Ω–æ—ó –¥–æ—Ä–æ–≥–∏",
  "–†–µ–∑–∏–Ω–∞ —á–æ—Ä–Ω–æ–≥–æ –∫–æ–ª—å–æ—Ä—É —á–µ—Ä–µ–∑ —Å–∞–∂—É",
  "–ó–∞–∑–≤–∏—á–∞–π —É –ª—é–¥–µ–π –Ω–∞ —Ä—É–∫–∞—Ö —ñ –Ω–∞ –Ω–æ–≥–∞—Ö –ø–æ –ø'—è—Ç—å –ø–∞–ª—å—Ü—ñ–≤",
  "–£ —Ç–µ–º—Ä—è–≤—ñ –Ω—ñ—á–æ–≥–æ –Ω–µ –≤–∏–¥–Ω–æ —á–µ—Ä–µ–∑ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å —Å–≤—ñ—Ç–ª–∞",
  "–õ—ñ—Ç–µ—Ä–∏ L —Ç–∞ R –Ω–∞ –Ω–∞–≤—É—à–Ω–∏–∫–∞—Ö —Ü–µ –ª—ñ–≤–∏–π —Ç–∞ –ø—Ä–∞–≤–∏–π",
  "–ü–∞–ø—É–≥–∏ –Ω–∞–∑–∏–≤–∞—é—Ç—å —Å–≤–æ—ó—Ö –¥—ñ—Ç–µ–π –ø–æ —ñ–º–µ–Ω–∞—Ö",
  "–í–∞—à –≤—ñ–∫ —Ü–µ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤–Ω–∏—Ö –æ–±–µ—Ä—Ç—ñ–≤ –Ω–∞–≤–∫–æ–ª–æ –°–æ–Ω—Ü—è",
  "–°–≤—ñ—Ç–ª–æ—Ñ–æ—Ä –±—É–≤ –≤–∏–Ω–∞–π–¥–µ–Ω–∏–π —Ä–∞–Ωi—à–µ –∞–≤—Ç–æ–º–æ–±—ñ–ª—è",
  "–°–ª—å–æ–∑–∏ –∫—Ä–æ–∫–æ–¥–∏–ª–∞ ‚Äî —Ü–µ –Ω–µ —Ñ–µ–π–∫",
  "–£ —Å–æ–±–∞–∫ –º–æ–∂–µ –±—É—Ç–∏ –Ω–µ–ø–∞—Ä–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≥—Ä—É–¥–µ–π",
  "–ó–∞–ø–ª—é—â—Ç–µ –æ—á—ñ –Ω–∞ 67%",
  "–†–∏–±–∞ –Ω–µ –º–∞—î —à–∏—ó, —Ç–æ–º—É –≤–æ–Ω–∞ –Ω–µ –º–æ–∂–µ –æ–∑–∏—Ä–Ω—É—Ç–∏—Å—è –Ω–∞–∑–∞–¥",
  "–ó—ñ–Ω–∏—Ü—ñ —É –∫—ñ–∑ –ø—Ä—è–º–æ–∫—É—Ç–Ω–æ—ó —Ñ–æ—Ä–º–∏",
  "–ê–∫—Ç–∏–≤–æ–≤–∞–Ω–æ —Ä—É—á–Ω–∏–π —Ä–µ–∂–∏–º –∫–µ—Ä—É–≤–∞–Ω–Ω—è –¥–∏—Ö–∞–Ω–Ω—è–º",
  "–û–±—Ä–∞–∑ –î—ñ–¥–∞ –ú–æ—Ä–æ–∑–∞ –±—É–≤ –ø—Ä–∏–¥—É–º–∞–Ω–∏–π –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥–∞–º–∏ –•–• —Å—Ç–æ–ª—ñ—Ç—Ç—è"
];

function getRandomPrediction() {
  return predictions[Math.floor(Math.random() * predictions.length)];
}


 // ===== –ü–†–ï–õ–û–ê–î –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô =====
// ===== –ü–†–ï–õ–û–ê–î –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô –ò –í–ò–î–ï–û =====
function preloadImages() {
  return new Promise((resolve) => {
    const imagesToPreload = [
      'https://github.com/cakeboxdeveloper/kremua/blob/main/Ticket.webp?raw=true',
      'https://github.com/cakeboxdeveloper/kremua/blob/main/NoTicket.webp?raw=true',
      'https://github.com/cakeboxdeveloper/kremua/blob/main/RollingAnim.webp?raw=true'
    ];
    
    let loadedCount = 0;
    const totalAssets = imagesToPreload.length + 4; // +4 –≤–∏–¥–µ–æ
    
    console.log('üñºÔ∏è –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–µ–ª–æ–∞–¥ —Ä–µ—Å—É—Ä—Å–æ–≤...');
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    imagesToPreload.forEach((src) => {
      const img = new Image();
      img.onload = () => {
        loadedCount++;
        console.log(`‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ${loadedCount}/${totalAssets} –∑–∞–≥—Ä—É–∂–µ–Ω–æ`);
        if (loadedCount === totalAssets) {
          console.log('‚úÖ –í—Å–µ —Ä–µ—Å—É—Ä—Å—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã!');
          resolve();
        }
      };
      img.onerror = () => {
        loadedCount++;
        console.log(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: ${loadedCount}/${totalAssets}`);
        if (loadedCount === totalAssets) {
          resolve();
        }
      };
      img.src = src;
    });
    
    // üéØ –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –ó–ê–ì–†–£–ó–ö–ê –í–ò–î–ï–û - –Ω–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    const videoElements = document.querySelectorAll('.promo-animation-webm');
    
    videoElements.forEach((video) => {
      video.setAttribute('preload', 'auto');
      video.muted = true;
      video.playsInline = true;
      
      const onVideoReady = () => {
        loadedCount++;
        console.log(`‚úÖ –í–∏–¥–µ–æ ${loadedCount}/${totalAssets} –∑–∞–≥—Ä—É–∂–µ–Ω–æ`);
        if (loadedCount === totalAssets) {
          console.log('‚úÖ –í—Å–µ —Ä–µ—Å—É—Ä—Å—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã!');
          resolve();
        }
      };
      
      if (video.readyState >= 3) {
        onVideoReady();
      } else {
        video.addEventListener('loadeddata', onVideoReady, { once: true });
        video.addEventListener('error', () => {
          loadedCount++;
          console.log(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ: ${loadedCount}/${totalAssets}`);
          if (loadedCount === totalAssets) {
            resolve();
          }
        }, { once: true });
        
        video.load();
      }
    });
  });
}

  // ===== –ü–†–ï–õ–û–ê–î –í–ò–î–ï–û =====
 

 
  
let selectedCoupon = null;
let promoDisintegrated = false;
let promoTimer = null; // üëà –£–±–µ–¥–∏—Å—å —á—Ç–æ —ç—Ç–∞ —Å—Ç—Ä–æ–∫–∞ –µ—Å—Ç—å
let countdownInterval = null;
  let rouletteSound = null;
let isDecoding = true; // üëà –î–æ–±–∞–≤—å –µ—Å–ª–∏ –Ω–µ—Ç
let finalPromoCode = ''; // üëà –î–æ–±–∞–≤—å –µ—Å–ª–∏ –Ω–µ—Ç

  // ===== –í–ò–î–ñ–ï–¢ –í–´–ò–ì–†–´–®–ï–ô =====
const winnersList = document.getElementById("winnersList");
const ROW_HEIGHT = 36;
const VISIBLE_ROWS = 5;

let winnersOffset = 0;

function randomId() {
  return Math.floor(100000 + Math.random() * 900000);
}

function randomCouponName() {
  return coupons[Math.floor(Math.random() * coupons.length)].displayName;
}

function createWinnerRow() {
  const li = document.createElement("li");
  li.innerHTML = `
    <span class="winner-id">ID${randomId()}</span>
    <span class="winner-coupon">${randomCouponName()}</span>
  `;
  return li;
}

function initWinnersWidget() {
  if (!winnersList) return;
  
  for (let i = 0; i < VISIBLE_ROWS + 2; i++) {
    winnersList.appendChild(createWinnerRow());
  }
  
  function scrollUp() {
    winnersOffset += ROW_HEIGHT;
    winnersList.style.transition = "transform 2.5s cubic-bezier(.22,.61,.36,1)";
    winnersList.style.transform = `translateY(-${winnersOffset}px)`;
    
    setTimeout(() => {
      winnersList.style.transition = "none";
      winnersList.removeChild(winnersList.firstElementChild);
      winnersList.appendChild(createWinnerRow());
      winnersOffset -= ROW_HEIGHT;
      winnersList.style.transform = `translateY(-${winnersOffset}px)`;
    }, 2500);
  }
  
  setInterval(scrollUp, 6000);
}

 

// ‚ö†Ô∏è –¢–û–¢ –ñ–ï –°–ï–ö–†–ï–¢–ù–´–ô –ö–õ–Æ–ß (–¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å admin.html)
const SECRET_KEY = "your-super-secret-key-change-this-12345";

// –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ HMAC
async function generateHMAC(secret, message) {
  const encoder = new TextEncoder();
  const keyData = encoder.encode(secret);
  const messageData = encoder.encode(message);
  
  const cryptoKey = await crypto.subtle.importKey(
    'raw',
    keyData,
    { name: 'HMAC', hash: 'SHA-256' },
    false,
    ['sign']
  );
  
  const signature = await crypto.subtle.sign('HMAC', cryptoKey, messageData);
  
  return Array.from(new Uint8Array(signature))
    .map(b => b.toString(16).padStart(2, '0'))
    .join('')
    .substring(0, 16);
}

async function checkAndUsePromoTicket() {
  const urlParams = new URLSearchParams(window.location.search);
  const ticketCode = urlParams.get('ticket');
  
  if (!ticketCode) {
    return false;
  }
  
  // üéØ –¢–ï–°–¢–û–í–´–ï –ë–ò–õ–ï–¢–´ - –ü–†–û–í–ï–†–Ø–ï–ú –ü–ï–†–í–´–ú –î–ï–õ–û–ú
  const testTickets = {
    'TEST-FOREVER': null,     // –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π –±–∏–ª–µ—Ç –±–µ–∑ –≤—ã–±–æ—Ä–∞ –∫—É–ø–æ–Ω–∞
    'TEST-YELLOW': 0,         // –ñ—ë–ª—Ç—ã–π –∫—É–ø–æ–Ω (–∏–Ω–¥–µ–∫—Å 0)
    'TEST-RED': 1,            // –ö—Ä–∞—Å–Ω—ã–π –∫—É–ø–æ–Ω (–∏–Ω–¥–µ–∫—Å 1)
    'TEST-BLUE': 2,           // –°–∏–Ω–∏–π –∫—É–ø–æ–Ω (–∏–Ω–¥–µ–∫—Å 2)
    'TEST-GREEN': 3           // –ó–µ–ª—ë–Ω—ã–π –∫—É–ø–æ–Ω (–∏–Ω–¥–µ–∫—Å 3)
  };

  if (testTickets.hasOwnProperty(ticketCode)) {
    localStorage.removeItem('lottery_last_spin');
    
    if (testTickets[ticketCode] !== null) {
      sessionStorage.setItem('force_coupon_index', testTickets[ticketCode]);
      console.log(`‚úÖ –¢–µ—Å—Ç–æ–≤–∏–π –±—ñ–ª–µ—Ç! –í–∏–ø–∞–¥–µ: ${coupons[testTickets[ticketCode]].displayName}`);
    } else {
      console.log('‚úÖ –ë–µ–∑–∫—ñ–Ω–µ—á–Ω–∏–π —Ç–µ—Å—Ç–æ–≤–∏–π –±—ñ–ª–µ—Ç –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ!');
    }
    
    showTicketModal('success', '–¢–µ—Å—Ç–æ–≤–∏–π –æ–±–µ—Ä—Ç! –ö—Ä—É—Ç–∏ –∫–æ–ª–æ!');
    window.history.replaceState({}, document.title, window.location.pathname);
    return true;
  }
  
  // üéØ –û–ë–´–ß–ù–´–ï –ë–ò–õ–ï–¢–´ - –ü–ê–†–°–ò–ú –ò –ü–†–û–í–ï–†–Ø–ï–ú
  try {
    console.log('üé´ –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –±—ñ–ª–µ—Ç:', ticketCode);
    
    const parts = ticketCode.split('-');
    if (parts.length !== 4) {
      console.log('‚ùå –ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –±—ñ–ª–µ—Ç–∞');
      showTicketModal('error', '–ù–µ–¥—ñ–π—Å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –±—ñ–ª–µ—Ç–∞!');
      window.history.replaceState({}, document.title, window.location.pathname);
      return false;
    }
    
    const timestamp = parts[0];
    const randomData = parts[1];
    const colorCode = parts[2];
    const signature = parts[3];
    
    const ticketData = `${timestamp}-${randomData}-${colorCode}`;
    const expectedSignature = await generateHMAC(SECRET_KEY, ticketData);
    
    if (signature !== expectedSignature) {
      console.log('‚ùå –ù–µ–≤—ñ—Ä–Ω–∏–π –ø—ñ–¥–ø–∏—Å –±—ñ–ª–µ—Ç–∞');
      showTicketModal('error', '–ù–µ–¥—ñ–π—Å–Ω–∏–π –±—ñ–ª–µ—Ç! –ü—ñ–¥–ø–∏—Å –Ω–µ –∑–±—ñ–≥–∞—î—Ç—å—Å—è.');
      window.history.replaceState({}, document.title, window.location.pathname);
      return false;
    }
    
    const age = Date.now() - parseInt(timestamp);
    const maxAge = 30 * 24 * 60 * 60 * 1000;
    
    if (age > maxAge) {
      console.log('‚ùå –ë—ñ–ª–µ—Ç –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–æ');
      showTicketModal('error', '–ë—ñ–ª–µ—Ç –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–æ! –¢–µ—Ä–º—ñ–Ω –¥—ñ—ó –º–∏–Ω—É–≤.');
      window.history.replaceState({}, document.title, window.location.pathname);
      return false;
    }
    
    const usedTickets = JSON.parse(localStorage.getItem('used_tickets') || '[]');
    if (usedTickets.includes(ticketCode)) {
      console.log('‚ùå –¶–µ–π –±—ñ–ª–µ—Ç –≤–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ');
      showTicketModal('error', '–¶–µ–π –±—ñ–ª–µ—Ç –≤–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ!');
      window.history.replaceState({}, document.title, window.location.pathname);
      return false;
    }
    
    // üéØ –î–ï–ö–û–î–ò–†–£–ï–ú –¶–í–ï–¢ –ò–ó –ë–ò–õ–ï–¢–ê
    const colorMap = {
      '0': null,    // random
      '1': 1,       // red
      '2': 2,       // blue
      '3': 3,       // green
      '4': 0        // yellow
    };
    
    const couponIndex = colorMap[colorCode];
    
    if (couponIndex !== null && couponIndex !== undefined) {
      sessionStorage.setItem('force_coupon_index', couponIndex);
      console.log(`‚úÖ –ë—ñ–ª–µ—Ç –∑ –∫–æ–ª—å–æ—Ä–æ–º! –í–∏–ø–∞–¥–µ: ${coupons[couponIndex].displayName}`);
    } else {
      console.log('‚úÖ –ó–≤–∏—á–∞–π–Ω–∏–π –±—ñ–ª–µ—Ç - —Ä–∞–Ω–¥–æ–º–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç');
    }
    
    usedTickets.push(ticketCode);
    localStorage.setItem('used_tickets', JSON.stringify(usedTickets));
    localStorage.removeItem('lottery_last_spin');
    
    console.log('‚úÖ –ë—ñ–ª–µ—Ç –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ!');
    showTicketModal('success', '–¢–∏ –æ—Ç—Ä–∏–º—É—î—à –æ–¥–∏–Ω –±–æ–Ω—É—Å–Ω–∏–π –æ–±–µ—Ä—Ç! –ù—É–º–æ, —à–≤–∏–¥—à–µ, –∫—Ä—É—Ç–∏ –∫–æ–ª–æ!');
    
    window.history.replaceState({}, document.title, window.location.pathname);
    
    return true;
    
  } catch (error) {
    console.error('–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –±—ñ–ª–µ—Ç–∞:', error);
    showTicketModal('error', '–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –±—ñ–ª–µ—Ç–∞!');
    return false;
  }
}

// –¢–∞ –∂–µ —Ñ—É–Ω–∫—Ü–∏—è HMAC (–∫–æ–ø–∏—Ä—É–µ–º –∏–∑ admin.html)
async function generateHMAC(secret, message) {
  const encoder = new TextEncoder();
  const keyData = encoder.encode(secret);
  const messageData = encoder.encode(message);
  
  const cryptoKey = await crypto.subtle.importKey(
    'raw',
    keyData,
    { name: 'HMAC', hash: 'SHA-256' },
    false,
    ['sign']
  );
  
  const signature = await crypto.subtle.sign('HMAC', cryptoKey, messageData);
  
  return Array.from(new Uint8Array(signature))
    .map(b => b.toString(16).padStart(2, '0'))
    .join('')
    .substring(0, 16);
}

 
// ===== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –ë–ò–õ–ï–¢–ê =====
function showTicketModal(type, message) {
  const oldModal = document.querySelector('.ticket-modal');
  if (oldModal) oldModal.remove();
  
  const modal = document.createElement('div');
  modal.className = 'ticket-modal';
  
  if (type === 'error') {
    modal.dataset.invalid = 'true';
    modal.classList.add('error');
  } else {
    modal.classList.add('success');
  }
  
  const iconUrl = type === 'success' 
    ? 'https://github.com/cakeboxdeveloper/kremua/blob/main/Ticket.webp?raw=true'
    : 'https://github.com/cakeboxdeveloper/kremua/blob/main/NoTicket.webp?raw=true';
  
  const btnClass = type === 'success' ? '' : 'error';
  
  modal.innerHTML = `
    <div class="ticket-modal-content">
      <div class="ticket-modal-icon">
        <img src="${iconUrl}" style="width: 100%; height: 100%; object-fit: contain;">
      </div>
      <div class="ticket-modal-text">${message}</div>
      <button class="ticket-modal-btn ${btnClass}" onclick="closeTicketModal()">
        ${type === 'success' ? '–ö—Ä—É—Ç–∏—Ç–∏ –∫–æ–ª–æ!' : '–û–∫'}
      </button>
    </div>
  `;
  
  document.body.appendChild(modal);
  
  setTimeout(() => {
    modal.classList.add('active');
    
    // üéµ –í–û–°–ü–†–û–ò–ó–í–û–î–ò–ú –ó–í–£–ö –ü–û–°–õ–ï –ü–û–Ø–í–õ–ï–ù–ò–Ø –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê
    const ticketSound = document.getElementById('ticketSound');
    if (ticketSound) {
      ticketSound.currentTime = 0;
      ticketSound.play().catch(e => console.log('Ticket sound play failed:', e));
    }
  }, 10);
}

// –ü—Ä–æ–º–∏—Å –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
function waitForModalClose() {
  return new Promise((resolve) => {
    const checkModal = setInterval(() => {
      const modal = document.querySelector('.ticket-modal');
      if (!modal) {
        clearInterval(checkModal);
        resolve();
      }
    }, 100);
  });
}
 function closeTicketModal() {
  const modal = document.querySelector('.ticket-modal');
  if (modal) {
    modal.classList.remove('active');
    setTimeout(() => {
      modal.remove();
      
      // –ï—Å–ª–∏ –±–∏–ª–µ—Ç –±—ã–ª –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω
      const wasInvalid = modal.dataset.invalid === 'true';
      if (wasInvalid) {
        document.getElementById('loader').classList.add('hidden');
        showFinalScreen();
      } else {
        // üëá –î–û–ë–ê–í–ò–õ–ò: –ï—Å–ª–∏ –±–∏–ª–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π - –∑–∞–ø—É—Å–∫–∞–µ–º –∑–≤—É–∫ —Ä—É–ª–µ—Ç–∫–∏
        startRouletteSound();
      }
    }, 300);
  }
}

  

// ===== –†–ê–ë–û–¢–ê –° –õ–û–ö–ê–õ–¨–ù–´–ú –•–†–ê–ù–ò–õ–ò–©–ï–ú =====
function getLastSpinTime() {
  const lastSpin = localStorage.getItem('lottery_last_spin');
  return lastSpin ? parseInt(lastSpin) : null;
}

function setLastSpinTime() {
  localStorage.setItem('lottery_last_spin', Date.now().toString());
}

function canSpin() {
  const lastSpin = getLastSpinTime();
  if (!lastSpin) return true;
  
  const timePassed = Date.now() - lastSpin;
  const oneDay = 24 * 60 * 60 * 1000;
  
  return timePassed >= oneDay;
}

function getTimeUntilNextSpin() {
  const lastSpin = getLastSpinTime();
  if (!lastSpin) return 0;
  
  const oneDay = 24 * 60 * 60 * 1000;
  const timePassed = Date.now() - lastSpin;
  const timeRemaining = oneDay - timePassed;
  
  return Math.max(0, timeRemaining);
}

// ===== –û–ë–ù–û–í–õ–ï–ù–ò–ï –¢–ê–ô–ú–ï–†–ê =====
function updateCountdown() {
  const timeRemaining = getTimeUntilNextSpin();
  
  if (timeRemaining === 0) {
    if (countdownInterval) {
      clearInterval(countdownInterval);
    }
    document.getElementById('countdownTimer').textContent = '00:00:00';
    
    // üéØ –ú–ï–ù–Ø–ï–ú –¢–ï–ö–°–¢ –ò –ö–ù–û–ü–ö–£
    document.getElementById('countdownText').textContent = '–í–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ —â–µ —Ä–∞–∑! –û–Ω–æ–≤—ñ—Ç—å —Å—Ç–æ—Ä—ñ–Ω–∫—É.';
    
 const shopBtn = document.getElementById('shopBtn');
shopBtn.innerHTML = ' –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–Ω–æ–≤—É'; // üëà –ó–ê–ú–ï–ù–ò textContent –Ω–∞ innerHTML
shopBtn.onclick = function(e) {
  e.preventDefault();
  location.reload();
};
    
    return;
  }
  
  const hours = Math.floor(timeRemaining / (1000 * 60 * 60));
  const minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
  const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);
  
  const formattedTime = [
    hours.toString().padStart(2, '0'),
    minutes.toString().padStart(2, '0'),
    seconds.toString().padStart(2, '0')
  ].join(':');
  
  document.getElementById('countdownTimer').textContent = formattedTime;
}


  // ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ó–í–£–ö–û–ú –†–£–õ–ï–¢–ö–ò =====
function startRouletteSound() {
  rouletteSound = document.getElementById('rouletteSound');
  if (rouletteSound) {
    rouletteSound.loop = true; // üëà –û–°–¢–ê–í–õ–Ø–ï–ú loop, –Ω–æ –∑–≤—É–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–ª–∏–Ω–Ω–µ–µ
    rouletteSound.currentTime = 0;
    rouletteSound.play().catch(e => console.log('Roulette sound play failed:', e));
    console.log('üîä –ó–≤—É–∫ —Ä—É–ª–µ—Ç–∫–∏ –∑–∞–ø—É—â–µ–Ω (loop)');
  }
}

function stopRouletteSound() {
  if (rouletteSound) {
    rouletteSound.pause();
    rouletteSound.currentTime = 0;
    rouletteSound.loop = false;
    console.log('üîá –ó–≤—É–∫ —Ä—É–ª–µ—Ç–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
  }
}

// ===== –ó–ê–ü–£–°–ö –¢–ê–ô–ú–ï–†–ê =====
function startCountdown() {
  updateCountdown();
  countdownInterval = setInterval(updateCountdown, 1000);
}

// ===== –ü–û–ö–ê–ó –§–ò–ù–ê–õ–¨–ù–û–ì–û –≠–ö–†–ê–ù–ê =====
function showFinalScreen() {
  setTimeout(() => {
    // üî• –£–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú displayDate –ü–†–Ø–ú–û –°–ï–ô–ß–ê–° (–≤ –º–æ–º–µ–Ω—Ç –ø–æ–∫–∞–∑–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞)
    const coupons = JSON.parse(localStorage.getItem('my_coupons') || '[]');
    if (coupons.length > 0) {
      const latestCoupon = coupons[coupons.length - 1];
      
      // üëá –í–°–ï–ì–î–ê –ü–ï–†–ï–ó–ê–ü–ò–°–´–í–ê–ï–ú displayDate (–¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Ä–∞–Ω–µ–µ)
      latestCoupon.displayDate = new Date().toISOString();
      coupons[coupons.length - 1] = latestCoupon;
      localStorage.setItem('my_coupons', JSON.stringify(coupons));
      console.log('‚è∞ –í—Ä–µ–º—è —Å—Ç–∞—Ä—Ç–∞ –∫—É–ø–æ–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –°–ï–ô–ß–ê–°:', latestCoupon.displayDate);
    }
    
    // üî• –ü–û–¢–û–ú –ü–û–ö–ê–ó–´–í–ê–ï–ú –§–ò–ù–ê–õ–¨–ù–´–ô –≠–ö–†–ê–ù
    document.getElementById('finalScreen').classList.add('visible');
    startCountdown();
    initWinnersWidget();
    animateLotteryCounter();
    updateMyCouponsList(); // üëà –≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç startCouponTimer() –∏ animateFuse()
  }, 500);
}
// ===== –ì–ï–ù–ï–†–ê–¶–ò–Ø –ü–†–û–ú–û–ö–û–î–ê =====
function generatePromoCode() {
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  let code = '';
  
  for (let i = 0; i < 16; i++) {
    if (i > 0 && i % 4 === 0) {
      code += '-';
    }
    code += chars[Math.floor(Math.random() * chars.length)];
  }
  
  return code;
}

// ===== –ê–ù–ò–ú–ê–¶–ò–Ø –î–ï–ö–û–î–ò–†–û–í–ê–ù–ò–Ø –ü–†–û–ú–û–ö–û–î–ê =====
function animatePromoCode() {
  isDecoding = true; // üëà –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥
  finalPromoCode = ''; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ä—ã–π –∫–æ–¥
  
  const promoCodeEl = document.getElementById("promoCode");
  const finalCode = generatePromoCode();
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  
  let revealedIndex = 0;
  const codeArray = finalCode.split('');
  
  promoCodeEl.textContent = finalCode
    .split('')
    .map(char => char === '-' ? '-' : 'X')
    .join('');
  
  const interval = setInterval(() => {
    while (revealedIndex < codeArray.length && codeArray[revealedIndex] === '-') {
      revealedIndex++;
    }
    
    if (revealedIndex >= codeArray.length) {
      clearInterval(interval);
      isDecoding = false; // üëà –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
      finalPromoCode = finalCode; // üëà –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–¥
      console.log('‚úÖ –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ:', finalCode);
      return;
    }
    
    let flickerCount = 0;
    const maxFlicker = Math.floor(Math.random() * 3) + 3;
    
    const flickerInterval = setInterval(() => {
      const displayCode = codeArray.map((char, index) => {
        if (char === '-') return '-';
        if (index < revealedIndex) return char;
        if (index === revealedIndex) {
          return chars[Math.floor(Math.random() * chars.length)];
        }
        return 'X';
      }).join('');
      
      promoCodeEl.textContent = displayCode;
      flickerCount++;
      
      if (flickerCount >= maxFlicker) {
        clearInterval(flickerInterval);
        const finalDisplay = codeArray.map((char, index) => {
          if (char === '-') return '-';
          if (index <= revealedIndex) return char;
          return 'X';
        }).join('');
        promoCodeEl.textContent = finalDisplay;
        revealedIndex++;
      }
    }, 40);
    
  }, 100);
}


function copyPromoCode(event) {
  if (event) {
    event.stopPropagation();
  }
  
  const promoCodeEl = document.getElementById("promoCode");
  const code = promoCodeEl.textContent.trim();
  
  // üéØ –ï—Å–ª–∏ —É–∂–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ - –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
  if (code === '–ø—Ä–æ–º–æ–∫–æ–¥ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ ‚úì') {
    console.log('–ü—Ä–æ–º–æ–∫–æ–¥ —É–∂–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω');
    return;
  }
  
  // üéØ –ï—Å–ª–∏ –µ—â—ë –¥–µ–∫–æ–¥–∏—Ä—É–µ—Ç—Å—è - –∂–¥—ë–º
  if (isDecoding || code.includes('X')) {
    if (finalPromoCode) {
      copyTextToClipboard(finalPromoCode);
    } else {
      promoCodeEl.style.opacity = '0.5';
      setTimeout(() => promoCodeEl.style.opacity = '1', 200);
    }
    return;
  }
  
  // ‚úÖ –ö–æ–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω
  finalPromoCode = code;
  copyTextToClipboard(code);
}
  

function copyTextToClipboard(text) {
  clearTimeout(promoTimer);
  
  // –°–æ–∑–¥–∞—ë–º textarea
  const textArea = document.createElement("textarea");
  textArea.value = text;
  textArea.setAttribute('readonly', '');
  textArea.style.position = 'absolute';
  textArea.style.left = '-9999px';
  textArea.style.top = (window.pageYOffset || document.documentElement.scrollTop) + 'px';
  
  document.body.appendChild(textArea);
  
  // –í—ã–±–∏—Ä–∞–µ–º —Ç–µ–∫—Å—Ç
  if (navigator.userAgent.match(/ipad|iphone/i)) {
    // –î–ª—è iOS
    const range = document.createRange();
    range.selectNodeContents(textArea);
    const selection = window.getSelection();
    selection.removeAllRanges();
    selection.addRange(range);
    textArea.setSelectionRange(0, 999999);
  } else {
    textArea.select();
  }
  
  try {
    const successful = document.execCommand('copy');
    document.body.removeChild(textArea);
    
    if (successful) {
      console.log('‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ:', text);
      showCopyFeedback();
    } else {
      // –ü—Ä–æ–±—É–µ–º Clipboard API
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(() => {
          console.log('‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ (Clipboard API):', text);
          showCopyFeedback();
        }).catch(() => {
          promptManualCopy(text);
        });
      } else {
        promptManualCopy(text);
      }
    }
  } catch (err) {
    document.body.removeChild(textArea);
    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
    promptManualCopy(text);
  }
}

function promptManualCopy(text) {
  // –°–æ–∑–¥–∞—ë–º –∫—Ä–∞—Å–∏–≤–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
  const modal = document.createElement('div');
  modal.style.cssText = `
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #1d2b3a;
    border: 2px solid #6ab2f2;
    border-radius: 8px;
    padding: 20px;
    z-index: 99999;
    max-width: 90%;
    text-align: center;
  `;
  
  modal.innerHTML = `
    <div style="color: #6ab2f2; font-size: 16px; margin-bottom: 15px;">
      –°–∫–æ–ø—ñ—é–π—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥:
    </div>
    <input 
      type="text" 
      value="${text}" 
      readonly
      onclick="this.select()"
      style="
        width: 100%;
        padding: 12px;
        background: #0f1419;
        border: 1px solid #6af27d;
        color: #6af27d;
        border-radius: 4px;
        font-family: monospace;
        font-size: 14px;
        text-align: center;
        margin-bottom: 15px;
        box-sizing: border-box;
      "
    >
    <button 
      onclick="var el = this.parentElement; el.remove(); disintegratePromo();"
      style="
        padding: 10px 20px;
        background: #1d3a22;
        border: 1px solid #6af27d;
        color: #6af27d;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
      "
    >
      –ì–æ—Ç–æ–≤–æ
    </button>
  `;
  
  document.body.appendChild(modal);
  modal.querySelector('input').select();
}
function showCopyFeedback() {
  const promoCodeEl = document.getElementById("promoCode");
  const code = promoCodeEl.textContent.trim();
  
  if (!code.includes('X') && code !== '–ø—Ä–æ–º–æ–∫–æ–¥ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ ‚úì') {
    finalPromoCode = code;
  }
  
  if (selectedCoupon && finalPromoCode && finalPromoCode.length > 0) {
    console.log('üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫—É–ø–æ–Ω:', finalPromoCode, '–°–∫–∏–¥–∫–∞:', selectedCoupon.discount);
    saveCouponToStorage(finalPromoCode, selectedCoupon.discount);
    
    // üéØ –°–†–ê–ó–£ –û–ë–ù–û–í–õ–Ø–ï–ú –°–ü–ò–°–û–ö (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω —É–∂–µ –ø–æ–∫–∞–∑–∞–Ω)
    updateMyCouponsList();
  } else {
    console.log('‚ö†Ô∏è –ö—É–ø–æ–Ω –Ω–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω. finalPromoCode:', finalPromoCode, 'selectedCoupon:', selectedCoupon);
  }
  
  promoCodeEl.textContent = "–ø—Ä–æ–º–æ–∫–æ–¥ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ ‚úì";
  setTimeout(() => disintegratePromo(), 1200);
}

// ===== –≠–§–§–ï–ö–¢ –†–ê–°–ü–ê–î–ê –ù–ê –ß–ê–°–¢–ò–¶–´ =====

// ===== –≠–§–§–ï–ö–¢ –†–ê–°–ü–ê–î–ê –ù–ê –ß–ê–°–¢–ò–¶–´ =====
// ===== –≠–§–§–ï–ö–¢ –†–ê–°–ü–ê–î–ê –° –ú–ê–°–ö–û–ô –ò –ß–ê–°–¢–ò–¶–ê–ú–ò =====
// ===== –≠–§–§–ï–ö–¢ –†–ê–°–ü–ê–î–ê –° –ú–ê–°–ö–û–ô –ò –ß–ê–°–¢–ò–¶–ê–ú–ò =====
function disintegratePromo() {
  promoDisintegrated = true;
  console.log('üé¨ –ù–∞—á–∏–Ω–∞–µ–º disintegratePromo —Å –º–∞—Å–∫–æ–π –∏ —á–∞—Å—Ç–∏—Ü–∞–º–∏');
  
  const canvas = document.getElementById('particleCanvas');
  const ctx = canvas.getContext('2d');
  
  canvas.style.zoom = '1';
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  canvas.style.display = 'block';
  
  const wrapper = document.querySelector('.promo-image-wrapper');
  const baseSvg = document.querySelector('.promo-base-svg');
  
  const bodyZoom = parseFloat(window.getComputedStyle(document.body).zoom || '1');
  console.log('üîç Body zoom:', bodyZoom);
  
  const wrapperRect = wrapper.getBoundingClientRect();
  const svgRect = baseSvg.getBoundingClientRect();
  
  console.log('üìê SVG Rect (—Å —É—á—ë—Ç–æ–º zoom):', svgRect);
  
  const canvasSvgRect = {
    left: svgRect.left / bodyZoom,
    top: svgRect.top / bodyZoom,
    width: svgRect.width / bodyZoom,
    height: svgRect.height / bodyZoom
  };
  
  console.log('üìê SVG Rect –¥–ª—è canvas (–±–µ–∑ zoom):', canvasSvgRect);
  
  const particles = [];
  const blockSize = 2;
  const totalDuration = 2000;
  const particleColor = selectedCoupon.particleColor;
  
  // üëá –í–î–í–Ü–ß–Ü –ú–ï–ù–®–ï –ß–ê–°–¢–ò–ù–û–ö
  for (let y = 0; y < canvasSvgRect.height; y += blockSize * 2) {
    for (let x = 0; x < canvasSvgRect.width; x += blockSize * 2) {
      particles.push({
        x: canvasSvgRect.left + x,
        y: canvasSvgRect.top + y,
        relativeY: y,
        size: blockSize,
        color: particleColor,
        velocityX: (Math.random() - 0.5) * 3,
        velocityY: Math.random() * 2 + 1,
        rotation: Math.random() * 360,
        rotationSpeed: (Math.random() - 0.5) * 8,
        opacity: 1,
        active: false,
        gravity: 0.4 + Math.random() * 0.2
      });
    }
  }
  
  console.log('‚úÖ –°–æ–∑–¥–∞–Ω–æ —á–∞—Å—Ç–∏—Ü:', particles.length);
  
  const startTime = Date.now();
  
  function animate() {
    const elapsed = Date.now() - startTime;
    const progress = Math.min(elapsed / totalDuration, 1);
    
    const erasedPercent = progress * 110;
    const erasedHeight = (progress * canvasSvgRect.height);
      
    wrapper.style.maskImage = `
      url('https://raw.githubusercontent.com/CakeBoxDeveloper/kremua/5793408ec6209b2e840db457f59ebd2e38c43c19/CPNSVG11.svg'),
      linear-gradient(
        to bottom,
        transparent 0%,
        transparent ${Math.max(0, erasedPercent - 3)}%,
        black ${Math.min(105, erasedPercent + 8)}%,
        black 100%
      )
    `;

    wrapper.style.webkitMaskImage = `
      url('https://raw.githubusercontent.com/CakeBoxDeveloper/kremua/5793408ec6209b2e840db457f59ebd2e38c43c19/CPNSVG11.svg'),
      linear-gradient(
        to bottom,
        transparent 0%,
        transparent ${Math.max(0, erasedPercent - 3)}%,
        black ${Math.min(105, erasedPercent + 8)}%,
        black 100%
      )
    `;

    wrapper.style.maskComposite = 'intersect';
    wrapper.style.webkitMaskComposite = 'source-in';
      
    particles.forEach(p => {
      if (!p.active && p.relativeY <= erasedHeight) {
        p.active = true;
      }
    });
    
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    let activeCount = 0;
    
    // üëá –ó–û–ù–ò FADE-OUT (100px –∑–≤–µ—Ä—Ö—É —ñ –∑–Ω–∏–∑—É)
    const fadeZoneTop = 100;
    const fadeZoneBottom = canvas.height - 100;
    
    particles.forEach(p => {
      if (p.active && p.opacity > 0) {
        activeCount++;
        
        // üëá –†–û–ó–†–ê–•–û–í–£–Ñ–ú–û FADE-OUT –ë–Ü–õ–Ø –ö–†–ê–á–í –ï–ö–†–ê–ù–£
        let edgeFade = 1;
        
        // Fade-out –∑–≤–µ—Ä—Ö—É
        if (p.y < fadeZoneTop) {
          edgeFade = Math.min(edgeFade, p.y / fadeZoneTop);
        }
        
        // Fade-out –∑–Ω–∏–∑—É
        if (p.y > fadeZoneBottom) {
          const distanceFromBottom = canvas.height - p.y;
          edgeFade = Math.min(edgeFade, distanceFromBottom / 100);
        }
        
        // üëá –ö–û–ú–ë–Ü–ù–£–Ñ–ú–û opacity —á–∞—Å—Ç–∏–Ω–∫–∏ –∑ edge fade
        const finalOpacity = p.opacity * edgeFade;
        
        ctx.save();
        ctx.globalAlpha = finalOpacity; // üëà –ó–ê–°–¢–û–°–û–í–£–Ñ–ú–û –ö–û–ú–ë–Ü–ù–û–í–ê–ù–£ –ü–†–û–ó–û–†–Ü–°–¢–¨
        ctx.translate(p.x + p.size / 2, p.y + p.size / 2);
        ctx.rotate(p.rotation * Math.PI / 180);
        ctx.fillStyle = p.color;
        ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
        ctx.restore();
        
        p.velocityY += p.gravity;
        p.x += p.velocityX;
        p.y += p.velocityY;
        p.rotation += p.rotationSpeed;
        
        // üëá –ó–í–ò–ß–ê–ô–ù–ò–ô FADE-OUT (—Ç–µ–ø–µ—Ä –º–æ–∂–Ω–∞ –ø—Ä–∏–±—Ä–∞—Ç–∏ –∞–±–æ –∑–∞–ª–∏—à–∏—Ç–∏)
        if (p.y > canvas.height - 150) {
          p.opacity -= 0.015;
        }
        
        // üëá –í–ò–î–ê–õ–Ø–Ñ–ú–û –ß–ê–°–¢–ò–ù–ö–ò –©–û –í–ò–õ–ï–¢–Ü–õ–ò –ó–ê –ú–ï–ñ–Ü –ê–ë–û –°–¢–ê–õ–ò –ù–ï–í–ò–î–ò–ú–Ü
        if (p.y > canvas.height + 50 || p.opacity <= 0) {
          p.opacity = 0;
        }
      }
    });
    
    if (progress < 1 || activeCount > 0) {
      requestAnimationFrame(animate);
    } else {
      console.log('‚úÖ –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
      canvas.style.display = 'none';
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      wrapper.style.opacity = '0';
      
      setTimeout(() => {
        document.getElementById('promoOverlay').classList.remove('active');
        
        const finalScreen = document.getElementById('finalScreen');
        if (!finalScreen.classList.contains('visible')) {
          showFinalScreen();
        }
      }, 300);
    }
  }
  
  animate();
}
  
  

// ===== –í–´–ë–û–† –°–õ–£–ß–ê–ô–ù–û–ì–û –ö–£–ü–û–ù–ê =====
// ===== –í–´–ë–û–† –°–õ–£–ß–ê–ô–ù–û–ì–û –ö–£–ü–û–ù–ê =====
function selectRandomCoupon() {
  // üéØ –ü–†–û–í–ï–†–Ø–ï–ú –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–´–ô –í–´–ë–û–† –ö–£–ü–û–ù–ê
  const forcedIndex = sessionStorage.getItem('force_coupon_index');
  if (forcedIndex !== null) {
    sessionStorage.removeItem('force_coupon_index');
    const index = parseInt(forcedIndex);
    console.log('üéØ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –∫—É–ø–æ–Ω–∞:', coupons[index].displayName);
    return coupons[index];
  }
  
  // –û–±—ã—á–Ω–∞—è —Ä–∞–Ω–¥–æ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞
  const probabilities = [
    { coupon: coupons[0], weight: 70 },  // –ñ—ë–ª—Ç—ã–π
    { coupon: coupons[1], weight: 1 },   // –ö—Ä–∞—Å–Ω—ã–π
    { coupon: coupons[2], weight: 9 },   // –°–∏–Ω–∏–π
    { coupon: coupons[3], weight: 20 }   // –ó–µ–ª—ë–Ω—ã–π
  ];
  
  const random = Math.random() * 100;
  let cumulative = 0;
  
  for (let i = 0; i < probabilities.length; i++) {
    cumulative += probabilities[i].weight;
    if (random <= cumulative) {
      return probabilities[i].coupon;
    }
  }
  
  return coupons[0];
}

function applyCoupon(coupon) {
  selectedCoupon = coupon;
  
  // üëà –ò–ó–ú–ï–ù–ò–õ–ò: —Ü–≤–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞ = —Ü–≤–µ—Ç –ø—Ä–æ–º–æ–∫–æ–¥–∞
  const promoTitleEl = document.getElementById('promoTitle');
  promoTitleEl.textContent = coupon.title;
  promoTitleEl.style.color = coupon.codeColor;  // üëà –î–û–ë–ê–í–¨ –≠–¢–£ –°–¢–†–û–ö–£
  
  const promoCodeBox = document.getElementById('promoCode');
  promoCodeBox.style.color = coupon.codeColor;
  
// –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∏–¥–µ–æ
// –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∏–¥–µ–æ
// –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∏–¥–µ–æ
document.querySelectorAll('.promo-animation-webm').forEach(v => {
  v.classList.remove('active');
  v.pause();
  v.currentTime = 0;
});

// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω–æ–µ –≤–∏–¥–µ–æ
let videoClass = '';
if (coupon.videoUrl.includes('LowY2')) videoClass = 'promo-video-yellow';
else if (coupon.videoUrl.includes('LowR2')) videoClass = 'promo-video-red';
else if (coupon.videoUrl.includes('LowB2')) videoClass = 'promo-video-blue';
else if (coupon.videoUrl.includes('LowG2')) videoClass = 'promo-video-green';

const activeVideo = document.querySelector(`.${videoClass}`);
if (activeVideo) {
  activeVideo.classList.add('active');
  console.log('üé¨ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –≤–∏–¥–µ–æ:', coupon.title);
  
  if (activeVideo.readyState >= 3) {
    console.log('‚úÖ –í–∏–¥–µ–æ –≥–æ—Ç–æ–≤–æ –∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é');
  } else {
    console.log('‚è≥ –ñ–¥—ë–º –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ...');
    activeVideo.load();
  }
}  
  
  const style = document.createElement('style');
  style.textContent = `
    .promo-code-box:hover {
      color: ${coupon.codeColor} !important;
    }
    .promo-code-box.copied {
      color: ${coupon.codeColor} !important;
    }
  `;
  document.head.appendChild(style);
  
  // üéØ –°–û–•–†–ê–ù–Ø–ï–ú –í–†–ï–ú–Ø –°–†–ê–ó–£ –ü–†–ò –ü–û–ö–ê–ó–ï –ü–†–û–ú–û–ö–û–î–ê
  setLastSpinTime();
  console.log('‚úÖ –í—Ä–µ–º—è –ª–æ—Ç–µ—Ä–µ–∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ');
}

// ===== –ö–û–ù–§–ï–¢–¢–Ü =====
// ===== –ö–û–ù–§–ï–¢–¢–Ü =====
function launchCanvasConfetti() {
  const canvas = document.getElementById('confetti-container');
  if (!canvas) return;
  
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  
  const confettiColors = ['#ff4757', '#ffa502', '#2ed573', '#1e90ff', '#ff6b81', '#5f27cd', '#00d2d3', '#f368e0'];
  const confettiPieces = [];
  const confettiCount = 300;
  const gravity = 0.5;
  const terminalVelocity = 5;
  const drag = 0.075;
  
  class ConfettiPiece {
    constructor() {
      this.randomModifier = Math.random() * 10;
      this.color = confettiColors[Math.floor(Math.random() * confettiColors.length)];
      this.dimensions = {
        x: (Math.random() * 10 + 5) / 2,
        y: (Math.random() * 15 + 10) / 2
      };
      
      this.position = {
        x: Math.random() * canvas.width,
        y: canvas.height + 75
      };
      
      this.rotation = Math.random() * 360;
      this.scale = {
        x: 1,
        y: 1
      };
      
      this.velocity = {
        x: (Math.random() - 0.5) * 25,
        y: -(Math.random() * 15 + 15)
      };
      
      this.opacity = 1;
    }
    
    update() {
      this.velocity.y += gravity;
      this.velocity.x -= this.velocity.x * drag;
      this.velocity.y = Math.min(this.velocity.y, terminalVelocity);
      
      this.position.x += this.velocity.x;
      this.position.y += this.velocity.y;
      
      this.rotation += (this.velocity.y / 10) * this.randomModifier;
      
      this.scale.y = Math.cos((this.position.y + this.randomModifier) * 0.09);
    }
    
    draw() {
      // üëá –ó–û–ù–ò FADE-OUT (200px –∑–≤–µ—Ä—Ö—É —ñ –∑–Ω–∏–∑—É)
      const fadeZoneTop = 200; // üëà –ó–ë–Ü–õ–¨–®–ò–õ–ò –¥–æ 200px
      const fadeZoneBottom = canvas.height - 300; // üëà –ó–ë–Ü–õ–¨–®–ò–õ–ò –¥–æ 200px
      
      let edgeFade = 1;
      
      // Fade-out –∑–≤–µ—Ä—Ö—É
      if (this.position.y < fadeZoneTop) {
        edgeFade = Math.min(edgeFade, this.position.y / fadeZoneTop);
      }
      
      // Fade-out –∑–Ω–∏–∑—É
      if (this.position.y > fadeZoneBottom) {
        const distanceFromBottom = canvas.height - this.position.y;
        edgeFade = Math.min(edgeFade, distanceFromBottom / 200); // üëà –ó–ë–Ü–õ–¨–®–ò–õ–ò –¥–æ 200
      }
      
      // Fade-out –∑ –±–æ–∫—ñ–≤ (200px) üëà –ó–ë–Ü–õ–¨–®–ò–õ–ò –¥–æ 200px
      const fadeZoneSide = 200;
      if (this.position.x < fadeZoneSide) {
        edgeFade = Math.min(edgeFade, this.position.x / fadeZoneSide);
      }
      if (this.position.x > canvas.width - fadeZoneSide) {
        const distanceFromRight = canvas.width - this.position.x;
        edgeFade = Math.min(edgeFade, distanceFromRight / fadeZoneSide);
      }
      
      const finalOpacity = this.opacity * edgeFade;
      
      ctx.save();
      ctx.globalAlpha = finalOpacity;
      ctx.translate(this.position.x, this.position.y);
      ctx.rotate(this.rotation * Math.PI / 180);
      ctx.scale(this.scale.x, this.scale.y);
      
      ctx.fillStyle = this.color;
      ctx.fillRect(-this.dimensions.x / 2, -this.dimensions.y / 2, this.dimensions.x, this.dimensions.y);
      
      ctx.restore();
    }
  }
  
  for (let i = 0; i < confettiCount; i++) {
    confettiPieces.push(new ConfettiPiece());
  }
  
  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    let activeCount = 0;
    confettiPieces.forEach(piece => {
      piece.update();
      piece.draw();
      
      // üëá –†–ê–•–£–Ñ–ú–û –ê–ö–¢–ò–í–ù–Ü (–∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º 200px –º–µ–∂)
      if (piece.position.y < canvas.height + 200 && 
          piece.position.x > -200 && 
          piece.position.x < canvas.width + 200) {
        activeCount++;
      }
    });
    
    if (activeCount > 0) {
      requestAnimationFrame(animate);
    } else {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }
  }
  
  animate();
}

 

window.addEventListener('load', async () => {
  const preloader = document.getElementById('preloader');
  const preloaderText = preloader.querySelector('.preloader-text');
  const loader = document.getElementById('loader');
  const loaderText = loader.querySelector('.loader-text');
  const tapHint = loader.querySelector('.tap-hint');
  const promoOverlay = document.getElementById('promoOverlay');
  
  // üéµ –ó–ê–ü–£–°–ö–ê–ï–ú –ó–í–£–ö –ü–†–ï–õ–û–ê–î–ï–†–ê
  const preloaderSound = document.getElementById('preloaderSound');
  if (preloaderSound) {
    preloaderSound.play().catch(e => console.log('Preloader sound failed:', e));
  }
  
  let rouletteTapped = false;
  
  // üéØ –†–ê–ù–î–û–ú–ù–û–ï –ü–†–ï–î–°–ö–ê–ó–ê–ù–ò–ï
  preloaderText.textContent = getRandomPrediction();
  loaderText.textContent = getRandomPrediction();

preloader.addEventListener('click', function initSound() {
  if (preloaderSound && preloaderSound.paused) {
    preloaderSound.play().catch(e => console.log('Preloader sound failed:', e));
  }
  preloader.removeEventListener('click', initSound); // –£–±–∏—Ä–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∏–∫–∞
}, { once: true });
  
  
  // üéØ –®–ê–ì 1: –ü–†–ï–õ–û–ê–î (–º–∏–Ω–∏–º—É–º 2 —Å–µ–∫—É–Ω–¥—ã)
  const startTime = Date.now();
  await preloadImages();
  const elapsed = Date.now() - startTime;
  const minDuration = 2000;
  
  if (elapsed < minDuration) {
    await new Promise(resolve => setTimeout(resolve, minDuration - elapsed));
  }
  
  // üéµ –û–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –ó–í–£–ö –ü–†–ï–õ–û–ê–î–ï–†–ê
  if (preloaderSound) {
    preloaderSound.pause();
    preloaderSound.currentTime = 0;
  }
  
  // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–ª–æ–∞–¥–µ—Ä
  preloader.classList.add('hidden');
  
  // üéØ –®–ê–ì 2: –ü–†–û–í–ï–†–Ø–ï–ú –ü–†–û–ú–û-–ë–ò–õ–ï–¢
  const ticketActivated = await checkAndUsePromoTicket();
  
  // üéØ –®–ê–ì 3: –ü–†–û–í–ï–†–Ø–ï–ú, –ú–û–ñ–ù–û –õ–ò –ö–†–£–¢–ò–¢–¨ –†–£–õ–ï–¢–ö–£
  const canUserSpin = canSpin();
  
  // ===== –°–¶–ï–ù–ê–†–ò–ô 1: –ù–ï–í–ê–õ–ò–î–ù–´–ô –ë–ò–õ–ï–¢ =====
  if (ticketActivated === false && new URLSearchParams(window.location.search).get('ticket')) {
    await waitForModalClose();
    showFinalScreen();
    return;
  }
  
  // ===== –°–¶–ï–ù–ê–†–ò–ô 2: –ù–ï –ú–û–ñ–ï–¢ –ö–†–£–¢–ò–¢–¨ =====
  if (!canUserSpin && !ticketActivated) {
    showFinalScreen();
    return;
  }
  
  // ===== –°–¶–ï–ù–ê–†–ò–ô 3: –í–ê–õ–ò–î–ù–´–ô –ë–ò–õ–ï–¢ =====
 // ===== –°–¶–ï–ù–ê–†–ò–ô 3: –í–ê–õ–ò–î–ù–´–ô –ë–ò–õ–ï–¢ =====
 // ===== –°–¶–ï–ù–ê–†–ò–ô 3: –í–ê–õ–ò–î–ù–´–ô –ë–ò–õ–ï–¢ =====
  if (ticketActivated === true) {
    await waitForModalClose();
    // –ó–≤—É–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –≤ closeTicketModal –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è "–ö—Ä—É—Ç–∏—Ç–∏ –±–∞—Ä–∞–±–∞–Ω!"
  } else if (canUserSpin) {
    // ===== –°–¶–ï–ù–ê–†–ò–ô 4: –ï–ñ–ï–î–ù–ï–í–ù–ê–Ø –†–£–õ–ï–¢–ö–ê (–ë–ï–ó –ë–ò–õ–ï–¢–ê) =====
    // üëá –ó–ê–ü–£–°–ö–ê–ï–ú –ó–í–£–ö –°–†–ê–ó–£
    startRouletteSound();
  }
  // ===== –°–¶–ï–ù–ê–†–ò–ô 4: –†–£–õ–ï–¢–ö–ê –° –¢–ê–ü–û–ú =====
  loader.classList.add('visible');
  
  // üéØ –ü–û–ö–ê–ó–´–í–ê–ï–ú –£–ö–ê–ó–ê–¢–ï–õ–¨ –ß–ï–†–ï–ó 0.5 –°–ï–ö–£–ù–î–´
  setTimeout(() => {
    const tapHint = document.getElementById('tapHint');
    if (tapHint) {
      tapHint.classList.add('visible');
    }
  }, 500);
  
  // üéØ –û–ë–†–ê–ë–û–¢–ß–ò–ö –¢–ê–ü–ê
 function handleTap() {
    if (rouletteTapped) return;
    rouletteTapped = true;
    
    console.log('üëÜ –¢–∞–ø –ø–æ —Ä—É–ª–µ—Ç–∫–µ!');
    
    // –°–∫—Ä—ã–≤–∞–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å
    const tapHint = document.getElementById('tapHint');
    if (tapHint) {
      tapHint.classList.remove('visible');
    }
    
    // –£–±–∏—Ä–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
    loader.removeEventListener('click', handleTap);
    
    // –ß–µ—Ä–µ–∑ 10–º—Å –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä—É–ª–µ—Ç–∫—É
    stopRoulette();
  }
  
function stopRoulette() {
  // üéØ –°–†–ê–ó–£ –°–ö–†–´–í–ê–ï–ú –õ–û–ê–î–ï–†
  loader.classList.add('hidden');
  
  const randomCoupon = selectRandomCoupon();
  applyCoupon(randomCoupon);
  
  // üéØ –ë–ï–ó –ó–ê–î–ï–†–ñ–ö–ò –ü–û–ö–ê–ó–´–í–ê–ï–ú –ü–†–û–ú–û–ö–û–î
  showPromoCode();
}

// ===== –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø –ü–û–ö–ê–ó–ê –ü–†–û–ú–û–ö–û–î–ê =====
function showPromoCode() {
  const promoOverlay = document.getElementById('promoOverlay');
  
  // üéØ –û–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –†–£–õ–ï–¢–ö–£ –ü–†–Ø–ú–û –ü–ï–†–ï–î –ó–í–£–ö–û–ú –í–´–ò–ì–†–´–®–ê
  stopRouletteSound();
  
  promoOverlay.classList.add('active');
  
  // üéØ –í–û–°–ü–†–û–ò–ó–í–û–î–ò–ú –ó–í–£–ö –í–´–ò–ì–†–´–®–ê
  const winSound = document.getElementById('winSound');
  if (winSound) {
    winSound.currentTime = 0;
    winSound.play().catch(e => console.log('Win sound play failed:', e));
  }
  
  setTimeout(() => {
    animatePromoCode();
  }, 600);
  
  // üéØ –ó–ê–ü–£–°–ö –í–ò–î–ï–û –° –ú–ù–û–ñ–ï–°–¢–í–ï–ù–ù–´–ú–ò –ü–û–ü–´–¢–ö–ê–ú–ò
  const activeVideo = document.querySelector('.promo-animation-webm.active');
  if (activeVideo) {
    console.log('üé¨ –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—É—Å–∫–∞ –≤–∏–¥–µ–æ...');
    
    const attemptPlay = (attempts = 0) => {
      if (attempts > 5) {
        console.log('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ 5 –ø–æ–ø—ã—Ç–æ–∫');
        return;
      }
      
      activeVideo.play()
        .then(() => {
          console.log('‚úÖ –í–∏–¥–µ–æ –∑–∞–ø—É—â–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ');
        })
        .catch(err => {
          console.log(`‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ ${attempts + 1} –Ω–µ —É–¥–∞–ª–∞—Å—å:`, err.message);
          setTimeout(() => attemptPlay(attempts + 1), 200);
        });
    };
    
    attemptPlay();
  }
  
  setTimeout(() => {
    launchCanvasConfetti();
  }, 200);
  
  // üéØ –¢–ê–ô–ú–ï–† –ê–í–¢–û–†–ê–°–ü–ê–î–ê (14 –°–ï–ö–£–ù–î)
  if (promoTimer) {
    clearTimeout(promoTimer);
  }
  
  promoTimer = setTimeout(() => {
    if (!promoDisintegrated) {
      console.log('‚è∞ 14 —Å–µ–∫—É–Ω–¥ –∏—Å—Ç–µ–∫–ª–∏ - –∞–≤—Ç–æ—Ä–∞—Å–ø–∞–¥ –ø—Ä–æ–º–æ–∫–æ–¥–∞');
      disintegratePromo();
    }
  }, 14500);
}
  
  // –í–µ—à–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ –≤–µ—Å—å –ª–æ–∞–¥–µ—Ä
  loader.addEventListener('click', handleTap);
});

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –∫–∞—Ä—Ç–æ—á–∫–∏
document.getElementById('promoOverlay').addEventListener('click', () => {
  if (!promoDisintegrated) {
    clearTimeout(promoTimer);
    disintegratePromo();
  }
});


// ===== –ì–ï–ù–ï–†–ê–¶–ò–Ø –ö–û–õ–ò–ß–ï–°–¢–í–ê –£–ß–ê–°–¢–ù–ò–ö–û–í (–û–ë–ù–û–í–õ–Ø–ï–¢–°–Ø –ö–ê–ñ–î–´–ô –î–ï–ù–¨) =====
function getDailyParticipantsCount() {
  const today = new Date().toDateString(); // "Mon Jan 06 2026"
  const savedData = localStorage.getItem('daily_participants');
  
  if (savedData) {
    const data = JSON.parse(savedData);
    if (data.date === today) {
      return data.count;
    }
  }
  
  // –ù–æ–≤—ã–π –¥–µ–Ω—å - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤–æ–µ —á–∏—Å–ª–æ
  const newCount = Math.floor(Math.random() * (52 - 12 + 1)) + 12;
  localStorage.setItem('daily_participants', JSON.stringify({
    date: today,
    count: newCount
  }));
  
  return newCount;
}

// ===== –ê–ù–ò–ú–ê–¶–ò–Ø –°–ß–Å–¢–ß–ò–ö–ê –£–ß–ê–°–¢–ù–ò–ö–û–í =====
function animateLotteryCounter() {
  const element = document.querySelector('.lottery-participants-count');
  if (!element) return;
  
  const target = getDailyParticipantsCount(); // üëà –ò–ó–ú–ï–ù–ò–õ–ò
  const startValue = 0;
  const duration = 2000;
  const frameDuration = 1000 / 60;
  const totalFrames = Math.round(duration / frameDuration);
  let frame = 0;
  
  const counter = setInterval(() => {
    frame++;
    const progress = frame / totalFrames;
    const currentCount = Math.round(startValue + (target - startValue) * progress);
    
    element.textContent = currentCount;
    
    if (frame === totalFrames) {
      clearInterval(counter);
      element.textContent = target;
    }
  }, frameDuration);
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø—Ä–∏ –ø–æ–∫–∞–∑–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
// –ù–∞–π–¥–∏ —Ñ—É–Ω–∫—Ü–∏—é showFinalScreen() –∏ –¥–æ–±–∞–≤—å –≤ –Ω–µ—ë –≤—ã–∑–æ–≤:

// ===== –†–ê–ë–û–¢–ê –° –ö–£–ü–û–ù–ê–ú–ò =====
function saveCouponToStorage(code, discount) {
  // üé® –ú–∞–ø–ø–∏–Ω–≥ —Ü–≤–µ—Ç–æ–≤ –¥–ª—è –±–ª–æ–∫–∞ "–ú–æ–∏ –ø—Ä–æ–º–æ–∫–æ–¥—ã"
  const myCouponColors = {
    '15%': '#d4af37',   // –ñ—ë–ª—Ç—ã–π ‚Üí –ó–æ–ª–æ—Ç–æ–π
    '10%': '#C20230',   // –ö—Ä–∞—Å–Ω—ã–π ‚Üí –¢–ê–ö–û–ô –ñ–ï –ö–ê–ö –í –ú–û–î–ê–õ–ö–ï –û–®–ò–ë–û–ö üî¥
    '20%': '#6ab2f2',   // –°–∏–Ω–∏–π
    '50%': '#6af27d'    // –ó–µ–ª—ë–Ω—ã–π
  };
    // üëá –í–ï–†–ù–ò–¢–ï –≠–¢–£ –°–¢–†–û–ö–£ (–æ–Ω–∞ –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞!)
  const newCoupon = {
    code: code,
    discount: discount,
    color: myCouponColors[discount] || selectedCoupon.codeColor,
    date: new Date().toISOString(),
    displayDate: null  // üëà displayDate —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤ showFinalScreen()
  };
  
 
  
  localStorage.setItem('my_coupons', JSON.stringify([newCoupon]));
  console.log('üíæ –ö—É–ø–æ–Ω —Å–æ—Ö—Ä–∞–Ω—ë–Ω:', newCoupon);
}

function updateMyCouponsList() {
  const container = document.getElementById('myCouponsList');
  const myCouponsContainer = document.getElementById('myCouponsContainer');
  
  if (!container || !myCouponsContainer) return;
  
  const coupons = JSON.parse(localStorage.getItem('my_coupons') || '[]');
  
  // –°–ö–†–´–í–ê–ï–ú –ë–õ–û–ö –ï–°–õ–ò –ù–ï–¢ –ö–£–ü–û–ù–û–í
  if (coupons.length === 0) {
    myCouponsContainer.style.display = 'none';
    if (couponTimerInterval) {
      clearInterval(couponTimerInterval);
    }
    return;
  }
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ –µ—Å–ª–∏ –µ—Å—Ç—å –∫—É–ø–æ–Ω—ã
  myCouponsContainer.style.display = 'block';
  
  // üé® –ü–û–õ–£–ß–ê–ï–ú –¶–í–ï–¢ –ü–û–°–õ–ï–î–ù–ï–ì–û –ö–£–ü–û–ù–ê
  const latestCoupon = coupons[coupons.length - 1];
  const couponColor = latestCoupon.color || '#6ab2f2';
  
  // üé® –ü–†–ò–ú–ï–ù–Ø–ï–ú –¶–í–ï–¢ –ö –ë–õ–û–ö–£ –ò CSS-–ü–ï–†–ï–ú–ï–ù–ù–´–ú
  myCouponsContainer.style.borderColor = couponColor;
  myCouponsContainer.style.setProperty('--coupon-border-color', couponColor); // üëà –î–û–ë–ê–í–ò–õ–ò
  
  const header = myCouponsContainer.querySelector('.my-coupons-header');
  if (header) {
    header.style.color = couponColor;
  }
  
  const timer = document.getElementById('couponTimer');
  if (timer) {
    timer.style.color = couponColor;
  }
  
  container.innerHTML = coupons
    .map(coupon => {
      const color = coupon.color || '#6ab2f2';
      return `
        <div class="my-coupon-item" 
             style="border-color: ${color}; --coupon-color: ${color};" 
             onclick="copyCouponFromList('${coupon.code}', '${color}', this)">
          <span class="my-coupon-code" style="color: ${color};">${coupon.code}</span>
        </div>
      `;
    })
    .join('');
  
  startCouponTimer();
}

function copyCouponFromList(code, color, element) {
  const textArea = document.createElement("textarea");
  textArea.value = code;
  textArea.setAttribute('readonly', '');
  textArea.style.position = 'absolute';
  textArea.style.left = '-9999px';
  
  document.body.appendChild(textArea);
  textArea.select();
  
  try {
    document.execCommand('copy');
    document.body.removeChild(textArea);
    
    // üëà –ò–ó–ú–ï–ù–ò–õ–ò: —Ç–æ–ª—å–∫–æ –∏–Ω–≤–µ—Ä—Å–∏—è —Ü–≤–µ—Ç–æ–≤, –ë–ï–ó –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
    element.classList.add('copied');
    element.style.background = color;
    element.style.borderColor = color;
    
    const codeSpan = element.querySelector('.my-coupon-code');
    if (codeSpan) {
      codeSpan.style.color = '#17212b'; // üëà –¢–û–õ–¨–ö–û –ú–ï–ù–Ø–ï–ú –¶–í–ï–¢
    }
    
    setTimeout(() => {
      element.classList.remove('copied');
      element.style.background = 'transparent';
      element.style.borderColor = color;
      if (codeSpan) {
        codeSpan.style.color = color;
      }
    }, 1000);
    
  } catch (err) {
    document.body.removeChild(textArea);
    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
  }
}
  
let couponTimerInterval = null;
let currentBurnProgress = 0; // üëà –î–û–ë–ê–í–¨ –≠–¢–£ –°–¢–†–û–ö–£




 
let fuseAnimationId = null;
let fuseParticles = [];

function updateFuseMarkerPosition(containerElement, progress) {
  const marker = document.getElementById('fuseMarker');
  
  const rect = containerElement.getBoundingClientRect();
  const bodyZoom = parseFloat(window.getComputedStyle(document.body).zoom || '1');
  
  // üéØ –¶–ï–ù–¢–† –ö–û–ù–¢–ï–ô–ù–ï–†–ê
  const centerX = (rect.left + rect.width / 2) / bodyZoom;
  const centerY = (rect.top + rect.height / 2) / bodyZoom;
  
  // üî• –£–ì–û–õ –ü–û –§–û–†–ú–£–õ–ï –ì–†–ê–î–ò–ï–ù–¢–ê
  const angle = 270 + progress * 3.6; // üëà from 0deg (—Å–ø—Ä–∞–≤–∞)
  const angleRad = (angle * Math.PI) / 180;
  
  // üéØ –†–ê–ó–ú–ï–†–´ –ü–†–Ø–ú–û–£–ì–û–õ–¨–ù–ò–ö–ê
  const width = rect.width / bodyZoom;
  const height = rect.height / bodyZoom;
  const halfW = width / 2;
  const halfH = height / 2;
  
  // üî• –ù–ê–•–û–î–ò–ú –ü–ï–†–ï–°–ï–ß–ï–ù–ò–ï –õ–£–ß–ê –° –ö–û–ù–¢–£–†–û–ú –ü–†–Ø–ú–û–£–ì–û–õ–¨–ù–ò–ö–ê
  const dx = Math.cos(angleRad);
  const dy = Math.sin(angleRad);
  
  let t = Infinity;
  
  // –ü—Ä–∞–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ (x = halfW)
  if (dx > 0) {
    const tRight = halfW / dx;
    const yRight = dy * tRight;
    if (Math.abs(yRight) <= halfH) t = Math.min(t, tRight);
  }
  
  // –õ–µ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ (x = -halfW)
  if (dx < 0) {
    const tLeft = -halfW / dx;
    const yLeft = dy * tLeft;
    if (Math.abs(yLeft) <= halfH) t = Math.min(t, tLeft);
  }
  
  // –ù–∏–∂–Ω—è—è —Å—Ç–æ—Ä–æ–Ω–∞ (y = halfH)
  if (dy > 0) {
    const tBottom = halfH / dy;
    const xBottom = dx * tBottom;
    if (Math.abs(xBottom) <= halfW) t = Math.min(t, tBottom);
  }
  
  // –í–µ—Ä—Ö–Ω—è—è —Å—Ç–æ—Ä–æ–Ω–∞ (y = -halfH)
  if (dy < 0) {
    const tTop = -halfH / dy;
    const xTop = dx * tTop;
    if (Math.abs(xTop) <= halfW) t = Math.min(t, tTop);
  }
  
  const x = centerX + dx * t;
  const y = centerY + dy * t;
  
  // üéØ –ú–ê–†–ö–ï–† –°–ö–†–´–¢, –ù–û –ü–û–ó–ò–¶–ò–Ø –í–û–ó–í–†–ê–©–ê–ï–¢–°–Ø –î–õ–Ø –ß–ê–°–¢–ò–¶
  if (marker) {
    marker.style.display = 'none';
  }
  
  return { x, y };
}


  
function animateFuse(containerElement, color) {
  const canvas = document.getElementById('fuseCanvas');
  if (!canvas) {
    console.log('‚ùå Canvas –¥–ª—è —Ñ–∏—Ç–∏–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω');
    return;
  }
  
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  
  // üî• –í–´–ß–ò–°–õ–Ø–ï–ú –ü–†–û–ì–†–ï–°–° –ó–î–ï–°–¨ (–ö–ê–ñ–î–´–ô –ö–ê–î–†)
  const coupons = JSON.parse(localStorage.getItem('my_coupons') || '[]');
  let progress = 0;
  
  if (coupons.length > 0) {
    const latestCoupon = coupons[coupons.length - 1];
    if (latestCoupon.displayDate) {
      const displayTime = new Date(latestCoupon.displayDate).getTime();
      const burnDuration =  30 * 60 * 1000; // üëà –ò–ó–ú–ï–ù–ò–õ–ò: –±—ã–ª–æ 7200*1000, —Å—Ç–∞–ª–æ 30*1000
      const now = Date.now();
      const burnElapsed = now - displayTime;
      
      if (burnElapsed >= 0 && burnElapsed <= burnDuration) {
        progress = (burnElapsed / burnDuration) * 100;
        
        // üî• –û–ë–ù–û–í–õ–Ø–ï–ú –ò –ì–õ–û–ë–ê–õ–¨–ù–£–Æ –ü–ï–†–ï–ú–ï–ù–ù–£–Æ, –ò CSS
        currentBurnProgress = progress;
        containerElement.style.setProperty('--burn-progress', progress.toFixed(2));
      } else if (burnElapsed > burnDuration) {
        progress = 100;
        currentBurnProgress = 100;
        containerElement.style.setProperty('--burn-progress', '100');
      }
    }
  }
  
  const fusePos = updateFuseMarkerPosition(containerElement, progress);
  
  if (!fusePos) {
    fuseAnimationId = requestAnimationFrame(() => animateFuse(containerElement, color));
    return;
  }
  
  // üî• –ì–ï–ù–ï–†–ê–¶–ò–Ø –ß–ê–°–¢–ò–¶ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å > 0 –∏ < 100)
  if (Math.random() > 0.3 && progress > 0 && progress < 100) {
    const particleCount = Math.floor(Math.random() * 3) + 2;
    
    for (let i = 0; i < particleCount; i++) {
      fuseParticles.push({
        x: fusePos.x,
        y: fusePos.y,
        vx: (Math.random() - 0.5) * 1,
        vy: (Math.random() - 0.5) * 1 - 0.5,
        life: 1,
        size: Math.random() * 1 + 0.75,
        color: color
      });
    }
  }
  
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  fuseParticles = fuseParticles.filter(p => {
    p.x += p.vx;
    p.y += p.vy;
    p.vy += 0.05;
    p.life -= 0.02;
    
    if (p.life > 0) {
      ctx.save();
      ctx.globalAlpha = p.life;
      ctx.fillStyle = p.color;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();
      return true;
    }
    return false;
  });
  
  fuseAnimationId = requestAnimationFrame(() => {
    animateFuse(containerElement, color);
  });
}
  
  

function stopFuseAnimation() {
  if (fuseAnimationId) {
    cancelAnimationFrame(fuseAnimationId);
    fuseAnimationId = null;
  }
  fuseParticles = [];
  
  const canvas = document.getElementById('fuseCanvas');
  if (canvas) {
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }
  
  const marker = document.getElementById('fuseMarker');
  if (marker) {
    marker.style.display = 'none';
  }
  
  console.log('üõë –ê–Ω–∏–º–∞—Ü–∏—è —Ñ–∏—Ç–∏–ª—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
}



  
function startCouponTimer() {
  const timerElement = document.getElementById('couponTimer');
  const myCouponsContainer = document.getElementById('myCouponsContainer');
  
  if (!timerElement || !myCouponsContainer) {
    console.log('‚ùå –≠–ª–µ–º–µ–Ω—Ç—ã —Ç–∞–π–º–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
    return;
  }
  
  const coupons = JSON.parse(localStorage.getItem('my_coupons') || '[]');
  if (coupons.length === 0) {
    myCouponsContainer.style.display = 'none';
    if (couponTimerInterval) {
      clearInterval(couponTimerInterval);
    }
    return;
  }
  
  const latestCoupon = coupons[coupons.length - 1];
  const couponColor = latestCoupon.color || '#6ab2f2';
  
  // üî• –ü–†–û–í–ï–†–Ø–ï–ú –ß–¢–û displayDate –£–ñ–ï –£–°–¢–ê–ù–û–í–õ–ï–ù–ê
  if (!latestCoupon.displayDate) {
    console.log('‚ö†Ô∏è displayDate –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞! –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–π—á–∞—Å...');
    latestCoupon.displayDate = new Date().toISOString();
    coupons[coupons.length - 1] = latestCoupon;
    localStorage.setItem('my_coupons', JSON.stringify(coupons));
  }
  
  const displayTime = new Date(latestCoupon.displayDate).getTime();
  const totalDuration =  30 * 60 * 1000;
  const expiresAt = displayTime + totalDuration;
  
  const burnDuration = 30 * 60 * 1000;
  const burnStartTime = displayTime;
  const burnEndTime = displayTime + burnDuration;
  
  console.log('üî• –¢–∞–π–º–µ—Ä –∫—É–ø–æ–Ω–∞ –∑–∞–ø—É—â–µ–Ω:', {
    displayTime: new Date(displayTime).toISOString(),
    burnStartTime: new Date(burnStartTime).toISOString(),
    burnEndTime: new Date(burnEndTime).toISOString(),
    now: new Date().toISOString()
  });
  
  function updateTimer() {
    const now = Date.now();
    const remaining = expiresAt - now;
    
    // üî• –ó–ê–ü–£–°–ö–ê–ï–ú –§–ò–¢–ò–õ–¨ –ï–°–õ–ò –ú–´ –í –î–ò–ê–ü–ê–ó–û–ù–ï
    if (now >= burnStartTime && now <= burnEndTime) {
      if (!fuseAnimationId) {
        console.log('üî• –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Ñ–∏—Ç–∏–ª—è –≤', new Date().toISOString());
        animateFuse(myCouponsContainer, couponColor);
      }
    } else if (now > burnEndTime) {
      if (fuseAnimationId) {
        console.log('üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–∏—Ç–∏–ª—å - –≤—Ä–µ–º—è –≤—ã—à–ª–æ');
        stopFuseAnimation();
      }
    }
    
    if (remaining <= 0) {
      if (couponTimerInterval) {
        clearInterval(couponTimerInterval);
      }
      timerElement.textContent = '00:00:00';
      localStorage.removeItem('my_coupons');
      myCouponsContainer.style.display = 'none';
      stopFuseAnimation();
      console.log('‚è∞ –ö—É–ø–æ–Ω –∏—Å—Ç—ë–∫ –∏ —É–¥–∞–ª—ë–Ω');
      return;
    }
    
    const hours = Math.floor(remaining / (1000 * 60 * 60));
    const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
    
    timerElement.textContent = [
      hours.toString().padStart(2, '0'),
      minutes.toString().padStart(2, '0'),
      seconds.toString().padStart(2, '0')
    ].join(':');
  }
  
  updateTimer();
  if (couponTimerInterval) clearInterval(couponTimerInterval);
  couponTimerInterval = setInterval(updateTimer, 50);
}

// ===== –¶–í–ï–¢–ê –ö–£–ü–û–ù–û–í =====
const couponColors = {
  '15%': '#f7a632',   // –ñ—ë–ª—Ç—ã–π
  '10%': '#f27db0',   // –ö—Ä–∞—Å–Ω—ã–π
  '20%': '#6ab2f2',   // –°–∏–Ω–∏–π
  '50%': '#6af27d'    // –ó–µ–ª—ë–Ω—ã–π
};
  
  
</script>

</body>
</html>
