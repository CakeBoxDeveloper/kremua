<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Технічне завдання | Кремуа</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  /* Основные настройки страницы */
  body {
    margin: 0;
    padding: 20px;
    background: #f0f0f0;
    font-family: 'Arial Black', Gadget, sans-serif; /* Для сходства с чертежным шрифтом */
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
  }

  /* Контейнер ТЗ (А4 пропорции или близко к фото) */
  #blueprint-container {
    width: 700px;
    background: #ffffff;
    padding: 40px;
    box-sizing: border-box;
    position: relative;
    border: 1px solid #000;
    color: #000;
  }

  /* Заголовок */
  .header-title {
    text-transform: uppercase;
    font-size: 28px;
    margin-bottom: 30px;
    border-bottom: 4px solid #000;
    padding-bottom: 10px;
  }

  /* Сетка для блоков */
  .grid-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 30px;
  }

  /* Стили коробок (рамок) */
  .info-box {
    border: 2px solid #000;
    min-height: 250px;
    padding: 15px;
    display: flex;
    flex-direction: column;
  }

  .box-title {
    text-transform: uppercase;
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 15px;
  }

  /* Стили картинок */
  .cake-image {
    width: 100%;
    height: auto;
    display: block;
  }

  /* Текстовые данные внутри блоков */
  .data-item {
    margin-bottom: 10px;
    font-family: Arial, sans-serif;
    font-size: 14px;
    text-transform: uppercase;
  }

  .data-item b {
    display: block;
    font-size: 16px;
    margin-bottom: 2px;
  }

  /* Нижний блок на всю ширину */
  .full-width-box {
    border: 2px solid #000;
    padding: 20px;
    margin-top: 20px;
    position: relative;
  }

  .footer-text {
    font-size: 14px;
    text-transform: uppercase;
    line-height: 1.4;
    padding-right: 100px; /* место под логотип */
  }

  /* Логотип-звездочка в углу */
  .logo-stamp {
    position: absolute;
    bottom: 10px;
    right: 10px;
    width: 80px;
  }

</style>
</head>
<body>

<div id="blueprint-container">
  <h1 class="header-title">ТЕХНІЧНЕ ЗАВДАННЯ ПО ЗАМОВЛЕННЮ #<span id="order-id">001</span></h1>

  <div class="grid-row">
    <div class="image-container">
      <img src="cake-blueprint-1.png" alt="Cake View 1" class="cake-image">
    </div>
    <div class="info-box">
      <div class="box-title">ПОДРОБИЦІ ЗАМОВЛЕННЯ</div>
      <div class="data-item"><b>Тип торта:</b> <span id="cake-type">завантаження...</span></div>
      <div class="data-item"><b>Начинка:</b> <span id="filling">завантаження...</span></div>
      <div class="data-item"><b>Добавки:</b> <span id="additives">завантаження...</span></div>
      <div class="data-item"><b>Формат:</b> <span id="format">завантаження...</span></div>
    </div>
  </div>

  <div class="grid-row">
    <div class="info-box">
      <div class="box-title">КОМЕНТАР ДО ЗАМОВЛЕННЯ</div>
      <div id="comment" style="font-family: Arial; font-size: 14px; line-height: 1.5;">немає</div>
    </div>
    <div class="image-container">
      <img src="cake-blueprint-2.png" alt="Cake View 2" class="cake-image">
    </div>
  </div>

  <div class="full-width-box">
    <div class="footer-text">
      ВАШЕ ТЗ СФОРМОВАНЕ. НАДІШЛІТЬ ЦЕЙ ДОКУМЕНТ КОНДИТЕРУ В ПЕРШОМУ ПОВІДОМЛЕННІ. 
      ЦЕ ДОПОМОЖЕ ШВИДШЕ РОЗПОЧАТИ РОБОТУ І ВИ ШВИДШЕ ОТРИМАЄТЕ СВОЄ ЗАМОВЛЕННЯ!
      А ЩЕ ВИ ДОДАТКОВО ОТРИМАЄТЕ ПЕРСОНАЛЬНУ ЗНИЖКУ НА ЦЕ ЗАМОВЛЕННЯ В 5%!
    </div>
    <svg class="logo-stamp" viewBox="0 0 100 100">
        <path d="M50 0 L61 35 L98 35 L68 57 L79 91 L50 70 L21 91 L32 57 L2 35 L39 35 Z" fill="black" />
        <text x="50" y="60" text-anchor="middle" fill="white" font-size="20" font-family="Arial">á</text>
    </svg>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
// ПОЛУЧЕНИЕ ДАННЫХ (Логика сохранена)
const urlParams = new URLSearchParams(window.location.search);
const isPreview = urlParams.get('preview') === 'true';

// Генерируем случайный ID заказа, если его нет в URL
const orderId = urlParams.get('id') || Math.floor(Math.random() * 9000) + 1000;
document.getElementById('order-id').textContent = orderId;

const data = {
  type: urlParams.get('type') || 'не обрано',
  filling: urlParams.get('filling') || 'не обрано',
  additive: urlParams.get('additive') || 'не обрано',
  format: urlParams.get('format') || 'не обрано',
  comment: urlParams.get('comment') || 'немає'
};

// Заполнение полей
document.getElementById('cake-type').textContent = decodeURIComponent(data.type);
document.getElementById('filling').textContent = decodeURIComponent(data.filling);
document.getElementById('additives').textContent = decodeURIComponent(data.additive);
document.getElementById('format').textContent = decodeURIComponent(data.format);
document.getElementById('comment').textContent = decodeURIComponent(data.comment);

// АВТО-СКРИНШОТ (Логика сохранена)
if (!isPreview) {
  window.addEventListener('load', () => {
    setTimeout(() => {
      const container = document.getElementById('blueprint-container');
      
      html2canvas(container, {
        backgroundColor: '#ffffff',
        scale: 2, // Высокое качество
        logging: false,
        useCORS: true // Важно, если картинки на другом домене
      }).then(canvas => {
        canvas.toBlob(blob => {
          const url = URL.createObjectURL(blob);
          const link = document.createElement('a');
          link.href = url;
          link.download = `order-${orderId}-blueprint.png`;
          link.click();
          URL.revokeObjectURL(url);
          
          setTimeout(() => {
            // window.location.href = 'constructor.html'; // Раскомментируйте для возврата
          }, 1000);
        });
      });
    }, 1000); // Небольшая задержка, чтобы картинки успели отрендериться
  });
}
</script>

</body>
</html>
